<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/images/icon2.png" />
    <title>Admin Dashbord</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />
    <!-- <link rel="stylesheet" href="/css/style.css" /> -->
    <!-- For Excel downloading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- jQuery UI -->
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css"
    />
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>

    <link
      href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />

    <link
      href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
    />
    <!-- Link to Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <!-- Your additional stylesheets -->
    <style>
      /* Your custom styles here */
       .dataTables_filter input[type="search"] {
        border: 1px solid #ccc;
        padding: 7px;
        border-radius: 20px;
        margin-right: 10px;
      }
      body {
        font-family: "Poppins", sans-serif;
      }

      .loader {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: inline-block;
        border-top: 3px solid #000000;
        border-right: 3px solid transparent;
        box-sizing: border-box;
        animation: rotation 1s linear infinite;
      }

      @keyframes rotation {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"
    />
    <link rel="stylesheet" href="/admin.css" />
  </head>

  <body>
    <!-- nav bar -->
    <nav class="navbar navbar-expand-lg bg-light navbar-dark fixed-top p-2">
      <div class="container-fluid text-white">
        <!-- sidenavbar trigger -->
          <i
          class="bx bx-menu"
          style="color: rgb(0, 0, 0); font-size: 35px"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasExample"
          aria-controls="offcanvasExample"
          aria-label="Toggle navigation"
        ></i>

        <!-- //sidenavbar trigger -->
        <!-- <img class="d-flex ms-auto" src="public/images/logo.png" alt="" style="width: 100px;"> -->
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
           <img
            src="/images/bookiva4.png"
            alt=""
            style="width: 130px; margin-left: 700px"
            class="logo-img"
          />
<!--           <img
            src="/images/icon2.png"
            alt=""
            style="width: 25px; margin-left: 750px"
          /> -->

          <form class="d-flex ms-auto" role="download">
            <div class="input-group my-3 my-lg-0">
              <div class="form-control">Download</div>

              <button
                class="btn btn-primary"
                type="button"
                id="button-addon2"
                style="background-color: black"
              >
                <!-- <i class="bi bi-download"></i> -->
                <i
                  class="bi bi-download"
                  id="downloadIcon"
                  onclick="downloadBasedOnState()"
                ></i>
              </button>
            </div>
          </form>
          <ul class="navbar-nav mb-lg-0">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="bi bi-person-fill"></i>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li>
                  <hr class="dropdown-divider" />
                </li>

                <li>
                  <a class="dropdown-item" href="#">Something else here</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- //nav bar -->

    <!-- offcanvas -->
    <div
      class="offcanvas offcanvas-start bg-dark sidebar-nav text-white"
      tabindex="-1"
      id="offcanvasExample"
      aria-labelledby="offcanvasExampleLabel"
    >
       <div class="offcanvas-body p-0 mt-3" style="background-color: black">
        <nav class="navbar-dark">
          <ul class="navbar-nav text-white" id="navbar">
            <li id="dashboardLink">
              <span class="text-uppercase text-muted fw-bold mx-3"> </span>
            </li>

            <div class="collapse" id="collapseExample">
              <div>
                <a href="#" class="nav-link mx-3 active">
                  <span class="me-2 ps-3">
                    <i class="bi bi-speedometer2"></i>
                  </span>
                  <span> DASHBORD </span>
                </a>
              </div>
            </div>

            <li id="tableLink">
              <span class="text-uppercase text-muted fw-bold mx-3"> Core </span>
            </li>

            <li id="pendingList" class="nav-item active">
              <a href="#" class="nav-link mx-3" data-target="pending">
                <span class="me-2">
                  <i class="bi bi-clock"></i>
                </span>
                <span> PENDING </span>
              </a>
            </li>
            <!-- Accepted -->
            <li id="acceptedList" class="nav-item">
              <a href="#" class="nav-link mx-3" data-target="accepted">
                <span class="me-2">
                  <i class="bi bi-check-circle"></i>
                </span>
                <span> ACCEPTED </span>
              </a>
            </li>
            <!-- Denied -->
            <li id="deniedList" class="nav-item">
              <a href="#" class="nav-link mx-3" data-target="denied">
                <span class="me-2">
                  <i class="bi bi-x-circle"></i>
                </span>
                <span> DENIED </span>
              </a>
            </li>

            <!-- For Users -->

            <li id="dashboardLink">
              <hr class="my-4" />
            </li>

            <li id="userLink">
              <span class="text-uppercase text-muted fw-bold mx-3">
                Users
              </span>
            </li>

            <li id="allUsersList" class="nav-item">
              <a href="#" class="nav-link mx-3" data-target="allUsers">
                <span class="me-2">
                  <i class="bi bi-people"></i>
                </span>
                <span> ALL USERS</span>
              </a>
            </li>
            <!-- Accepted -->
            <li id="cancelledList" class="nav-item">
              <a href="#" class="nav-link mx-3" data-target="cancelled">
                <span class="me-2">
                  <i class="fa-sharp fa-regular fa-thumbs-down"></i>
                </span>
                <span>CANCELLED</span>
              </a>
            </li>

            <li id="dashboardLink">
              <hr class="my-4" />
            </li>

            <li id="logout" class="nav-item">
              <a href="#" class="nav-link mx-3" data-target="logout">
                <span class="me-2">
                  <i class="bx bx-log-out-circle"></i>
                </span>
                <span>LOG OUT</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
    <!--// offcanvas -->

    <!-- main -->
    <main class="mt-5 pt-3">
      <div class="container-fluid">
        <div class="row">
          <div id="recordsTitle" class="col-md-12 fw-bold fs-4">
            Pending Records
          </div>
        </div>
        <!-- card section -->

        <div
          class="modal fade"
          id="myModal"
          tabindex="-1"
          role="dialog"
          aria-labelledby="myModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="myModalLabel">
                  Reason for event failed
                </h5>
                <button
                  type="button"
                  class="btn secondary-btn"
                  data-dismiss="modal"
                  aria-label="Close"
                  id="crossBtnaccepted"
                >
                  <span aria-hidden="true" style="font-size: 25px"
                    >&times;</span
                  >
                </button>
              </div>
              <div
                class="modal-body"
                style="max-height: 300px; overflow-y: auto"
              >
                Event has been cancelled because of the Chief Guest have another
                urgent work.
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn"
                  id="closeModalBtn"
                  data-dismiss="modal"
                  style="background-color: red; color: white"
                >
                  Close
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <!-- <div class="col-md-3 mb-2">
            <div class="card text-bg-danger mb-3 h-100">
              <div class="card-header">Header</div>
              <div class="card-body">
                <h5 class="card-title">Primary card title</h5>
                <p class="card-text">
                  Some quick example text to build on the card title and make up
                  the bulk of the card's content.
                </p>
              </div>
            </div>
          </div> -->
          <!-- <div class="col-md-3 mb-2">
            <div class="card text-bg-success mb-3 h-100">
              <div class="card-header">Header</div>
              <div class="card-body">
                <h5 class="card-title">warning card title</h5>
                <p class="card-text">
                  Some quick example text to build on the card title and make up
                  the bulk of the card's content.
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-2">
            <div class="card text-bg-Primary mb-3 h-100">
              <div class="card-header">Header</div>
              <div class="card-body">
                <h5 class="card-title">Primary card title</h5>
                <p class="card-text">
                  Some quick example text to build on the card title and make up
                  the bulk of the card's content.
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-2">
            <div class="card text-bg-info mb-3 h-100">
              <div class="card-header">Header</div>
              <div class="card-body">
                <h5 class="card-title">Primary card title</h5>
                <p class="card-text">
                  Some quick example text to build on the card title and make up
                  the bulk of the card's content
                </p>
              </div>
            </div>
          </div>
        </div> -->
          <!-- //card section -->
          <!-- charts section -->
          <div class="row">
            <div class="col-md-6">
              <!-- <div class="card"> -->
              <!-- <div class="card-header">Charts</div> -->
              <div class="card-body">
                <!-- <canvas class="chart" id="chart" width="400" height="200">
                </canvas> -->
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <!-- <div class="card"> -->
            <div class="card-header"></div>
            <div class="card-body">
              <canvas
                class="chart"
                id="mychart"
                width="400"
                height="200"
                style="display: none"
              >
              </canvas>
            </div>
          </div>
        </div>
      </div>
      <!-- charts section -->
      <!-- table section -->

      <div class="row mt-3">
        <div class="col-md-15">
          <div class="filter-options" style="display: none">
            <label
              for="filter"
              style="font-weight: bold; font-size: 15px; margin-left: 8px"
              >Filter By:</label
            >

            <select id="hall-name-filter" class="table-filter">
              <option value="all" disabled selected>Hall Name</option>
              <option value="all" style="font-weight: bold">None</option>
              <option value="Alpha Hall" id="alpha">Alpha Hall</option>
              <option value="Beta Hall">Beta Hall</option>
              <option value="Gamma Hall">Gamma Hall</option>
              <option value="Sigma Hall">Sigma Hall</option>
              <option value="Leo Muthu Stadium">Leo Muthu Stadium</option>
              <option value="VRR Hall">VRR Hall</option>
              <option value="SSR Hall">SSR Hall</option>
              <option value="SIT AV Hall">SIT AV Hall</option>
              <option value="SIT Smart Classroom">SIT Smart Classroom</option>
              <option value="SEC AV Hall">SEC AV Hall</option>
              <!-- Add options for Hall Name filtering -->
            </select>

            <div class="table-filter" id="food-filter">
              <!-- <label for="food-filter">Food Type:</label> -->
              <div class="dropdown">
                <button class="dropbtn">Food Type</button>
                <div class="dropdown-content" id="food-dropdown">
                  <label
                    ><input type="checkbox" value="Breakfast" />
                    Breakfast</label
                  >
                  <label><input type="checkbox" value="Lunch" /> Lunch</label>
                  <label><input type="checkbox" value="Dinner" /> Dinner</label>
                  <!-- Add more food options here -->
                </div>
              </div>
            </div>

            <select id="dept-filter" class="table-filter">
              <option value="all" disabled selected>Department</option>
              <option value="all" style="font-weight: bold">None</option>
              <option value="AIDS">AIDS</option>
              <option value="CCE">CCE</option>
              <option value="CIVIL">CIVIL</option>
              <option value="CSE">CSE</option>
              <option value="CYBER">CYBER</option>
              <option value="ECE">ECE</option>
              <option value="EEE">EEE</option>
              <option value="ICE">ICE</option>
              <option value="IEI">IEI</option>
              <option value="IOT">IOT</option>
              <option value="IT">IT</option>
              <option value="MBA">MBA</option>
              <option value="MECH">MECH</option>

              <!-- Add options for Department filtering -->
            </select>

            <input
              type="text"
              id="start-date"
              class="table-filter"
              placeholder="Start Date"
            />
            <input
              type="text"
              id="end-date"
              class="table-filter"
              placeholder="End Date"
            />
          </div>

          <div class="card">
            <div
              id="logoutModal"
              class="modal"
              data-easein="bounceIn"
              tabindex="-1"
              role="dialog"
              aria-labelledby="logoutModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h4 class="modal-title">LOG OUT?</h4>
                    <button
                      type="button"
                      class="btn secondary-btn"
                      data-dismiss="modal"
                      aria-label="Close"
                      id="crosslogout"
                    >
                      <span aria-hidden="true" style="font-size: 25px"
                        >&times;</span
                      >
                    </button>
                  </div>
                  <div class="modal-body">
                    <p>Are you sure to log out?</p>
                  </div>
                  <div class="modal-footer">
                    <button
                      class="btn btn-default"
                      data-dismiss="modal"
                      id="closelogout"
                      aria-hidden="true"
                    >
                      Close
                    </button>
                    <button
                      class="btn btn-primary"
                      id="confirmLogout"
                      style="background-color: #cf1020; border: none"
                    >
                      Ok
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- <div class="card-header">Data tables</div> -->
            <div class="card-body">
              <table id="animation-table">
                <tbody>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                </tbody>
              </table>
              <div class="table-responsive">
                <!-- <table
                    id="example"
                    class="display data-table"
                    style="width: 100%"
                  >
                    <thead>
                      <tr>
                        <th>No</th>
                        <th>Hall name</th>
                        <th>Name</th>
                        <th>Dept</th>
                        <th>Date</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Seats</th>
                        <th>Event Name</th>
                        <th>Purpose</th>
                        <th>Refresh For</th>
                        <th>Refresh Type</th>
                        <th>Food</th>
                        <th>Accept</th>
                        <th >Reject</th>
                        
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Tiger Nixon</td>
                        <td>System Architect</td>
                        <td>Edinburgh</td>
                        <td>61</td>
                        <td>2011-04-25</td>
                        <td>$320,800</td>
                        <td>Tiger Nixon</td>
                        <td>System Architect</td>
                        <td>Edinburgh</td>
                        <td>Edinburgh</td>
                        <td>61</td>
                        <td>2011-04-25</td>
                        <td>$320,800</td>

                  
                        <td>2011-04-25</td>
                        <td>$320,800</td>
                      </tr>
                   
                      
                    </tbody>
                    <tfoot>
                      <tr>
                        <th>Name</th>
                        <th>Position</th>
                        <th>Office</th>
                        <th>Age</th>
                        <th>Start date</th>
                        <th>Salary</th>
                      </tr>
                    </tfoot>
                  </table> -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--//table section -->
    </main>
    <!-- //main -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js
  "></script>
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <!-- <script src="/admin.js"></script> -->

    <script>
      const API_LOCAL = "https://bookiva-backend-incubation.vercel.app";
      let NAME, Name, EMAIL;
      menu();
      async function menu() {
        const response = await fetch(API_LOCAL + "/profile", {
          credentials: "include", // Include cookies with the request
          headers: {
            "Content-Type": "application/json",
          },
        });
        // if(response.status==401){
        //   location.href='/login/'
        // }
        NAME = await response.json();
        Name = NAME.name;
        EMAIL = NAME.email;
        if (NAME) {
          let profile;

          if (NAME.role == "USER") {
            location.href = "/venues/";
          } 
          // else if (NAME.role == "MANAGEMENT") {
          //   location.href = "/management/";
          // }
        }
      }

      $(document).ready(function () {
        $(".data-table").each(function (_, table) {
          $(table).DataTable();
        });
      });

      var allUsers;
      var dataCancelled;

      var dataPending;
      var dataAllowed;
      var dataDenied;

      var acceptButtonStyle =
        "background-color: #009150; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;";
      var rejectButtonStyle =
        "background-color: #CF1020; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;";

      var userButtonStyle =
        "background-color: #007FFF; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;";

      // Function to accept a booking
      const updateUserStatus = async (index, tableId, currData, action) => {
        currData = allUsers;
        // console.log(currData)

        const name = currData[index].name;
        const dept = currData[index].dept;
        const college = currData[index].college;
        const email = currData[index].email;
        const blockStatus = currData[index].blockStatus;

        const button = $(`#${tableId} button#block[data-index="${index}"]`);
        console.log(button, index, tableId);
        button.prop("disabled", true); // Disable the button to prevent multiple clicks
        button.html(action === "block" ? "Blocking..." : "Unblocking..."); // Change button text to Loading...
        button.css({
          transition: "background-color 0.3s ease",
          backgroundColor: "rgba(0, 0, 0, 0.5)", // Fade the button to a semi-transparent black color
        });

        try {
          // Send request to update the status to accepted
          const response = await fetch(API_LOCAL + "/updateUserStatus", {
            mode: "cors",
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              blockStatus: blockStatus,
              updateStatus: blockStatus == false ? true : false,
              email,
              name,
              dept,
              college,
            }),
            credentials: "include",
          });
          if (response.status == 401) {
            location.href = "/login/";
            return;
          }
          if (response.ok) {
            if (currentState == "cancelled") {
              fetchAndDisplayData();
              // createTable(dataCancelled,currentState)
            } else if (currentState == "allUsers") {
              getUsers();
            }
            console.log("status is updated");
          } else {
            console.error("Failed to update User status.");
          }
        } catch (error) {
          console.error("Error while updating user status:", error);
        }
      };

      const createUsers = (userData, type) => {
        const tableId = `admin-${type}-records`;

        if (!userData || userData.length === 0) {
          // const hideFilterOptions = $(`.filter-options`).css({"display":"none"})
          const message = `There is no ${type} data.`;
          const messageDiv = $(`<div>${message}</div>`).css({
            "text-align": "center",
          });
          return messageDiv;
        }
        $(`.filter-options`).css({ display: "none" });

        const table = $("<table>")
          .attr("id", `admin-${type}-records`)
          .addClass("display data-table")
          .css("width", "100%", "overflowX", "auto");

        const thead = $("<thead>").appendTo(table);
        $("<tr>")
          .appendTo(thead)
          .append("<th>No</th>")
          .append("<th>Name</th>")
          .append("<th>Dept</th>")
          .append("<th>College</th>")
          .append("<th>Email</th>")
          .append("<th>Status</th>");

        const tbody = $("<tbody>").appendTo(table);

        userData.forEach((user, index) => {
          const newRow = $("<tr>");

          newRow.append(`<td>${index + 1}</td>`);
          newRow.append(`<td>${user.name}</td>`);
          newRow.append(`<td>${user.dept}</td>`);
          newRow.append(`<td>${user.college}</td>`);
          newRow.append(`<td>${user.email}</td>`);

          if (user.blockStatus) {
            newRow.css("color", "red"); // Fading the row if block status is true
            userButtonStyle =
              "background-color: #007FFF; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;";

            newRow.append(
              `<td><button style="${userButtonStyle}"  onclick="updateUserStatus(${index}, '${tableId}', '${allUsers}','unblock')" data-index="${index}" id="block">Unblock</button></td>`
            );
          } else {
            userButtonStyle =
              "background-color:  #FF0800; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;";

            newRow.append(
              `<td><button style="${userButtonStyle}"  onclick="updateUserStatus(${index}, '${tableId}', '${allUsers}','block')" data-index="${index}" id="block">Block</button></td>`
            );
          }

          tbody.append(newRow);
        });

        return table;
      };

      // Function to create a new table element with the provided bookings data and type
      const createTable = (bookings, type) => {
        // $(".table-responsive").empty();

        const tableId = `admin-${type}-records`;
        $("#animation-table").remove();

        if (!bookings || bookings.length === 0) {
          const hideFilterOptions = $(`.filter-options`).css({
            display: "none",
          });
          const message = `There is no ${type} data.`;
          const messageDiv = $(`<div>${message}</div>`).css({
            "text-align": "center",
          });
          return messageDiv;
        }
        $(`.filter-options`).css({ display: "flex" });

        // Create a new table element
        const table = $("<table>")
          .attr("id", `admin-${type}-records`)
          .addClass("display data-table")
          .css("width", "100%", "overflowX", "auto");

        // Create the table header
        const thead = $("<thead>").appendTo(table);
        $("<tr>")
          .appendTo(thead)
          .append("<th>No</th>")
          .append("<th>Hall name</th>")
          .append("<th>Name</th>")
          .append("<th>Dept</th>")
          .append("<th>Date</th>")
          .append("<th>Start Time</th>")
          .append("<th>End Time</th>")
          .append("<th>Seats</th>")
          .append("<th>Event Name</th>")
          .append("<th>Purpose</th>")
          .append("<th>Refresh For</th>")
          .append("<th>Refresh Type</th>")
          .append("<th>Food</th>");

        if (type === "pending") {
          thead.find("tr").append("<th>Accept</th>").append("<th>Reject</th>");
        } else if (type === "accepted") {
          thead.find("tr").append("<th>Reject</th>");
        } else if (type === "denied") {
          thead.find("tr").append("<th>Accept</th>");
        } else if (type === "cancelled") {
          thead.find("tr").append("<th>Reason</th>");
        }

        // Create the table body
        const tbody = $("<tbody>").appendTo(table);

        // Populate table with fetched data
        const currentDate = new Date();
        currentDate.setHours(0, 0, 0, 0);
        bookings.forEach((booking, index) => {
          const bookingDate = new Date(booking.date);
          if (bookingDate >= currentDate) {
            const newRow = $("<tr>");

            newRow.append(`<td>${index + 1}</td>`); // Index starts from 0
            newRow.append(`<td>${booking.hallname}</td>`);
            newRow.append(`<td>${booking.name}</td>`);
            newRow.append(`<td>${booking.dept}</td>`);
            newRow.append(
              `<td>${new Date(booking.date).toLocaleDateString("en-GB")}</td>`
            );
            newRow.append(
              `<td>${new Date(booking.starttime).getUTCHours() % 12 || 12}:${
                (new Date(booking.starttime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.starttime).getUTCMinutes()
              } ${
                new Date(booking.starttime).getUTCHours() < 12 ? "AM" : "PM"
              }</td>`
            );
            newRow.append(
              `<td>${new Date(booking.endtime).getUTCHours() % 12 || 12}:${
                (new Date(booking.endtime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.endtime).getUTCMinutes()
              } ${
                new Date(booking.endtime).getUTCHours() < 12 ? "AM" : "PM"
              }</td>`
            );
            newRow.append(`<td>${booking.seating}</td>`);
            newRow.append(`<td>${booking.eventname}</td>`);
            newRow.append(`<td>${booking.purpose.toLowerCase()}</td>`);
            newRow.append(`<td>${booking.refreshmentfor.toLowerCase()}</td>`);
            newRow.append(`<td>${booking.refreshmenttype.toLowerCase()}</td>`);
            newRow.append(`<td>${booking.food.join(" ")}</td>`);

            if (type === "pending") {
              if (booking.status === "denied_temp") {
                acceptButtonStyle =
                  "background-color: #009150; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;opacity: 0.5;cursor: not-allowed;";
                newRow.append(
                  `<td><button style="${acceptButtonStyle}">Accept</button></td>`
                );
              } else {
                acceptButtonStyle =
                  "background-color: #009150; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;";
                newRow.append(
                  `<td><button style="${acceptButtonStyle}" onclick="acceptBooking(${index}, 'admin-${currentState}-records', '${currentState}')" data-index="${index}" id="act">Accept</button></td>`
                );
              }
              newRow.append(
                `<td><button style="${rejectButtonStyle}" onclick="rejectBooking(${index}, '${tableId}', '${dataPending}')" data-index="${index}" id="rej">Reject</button></td>`
              );
            } else if (type === "accepted") {
              newRow.append(
                `<td><button style="${rejectButtonStyle}" onclick="rejectBooking(${index}, '${tableId}', '${dataAllowed}')" data-index="${index}" id="rej">Reject</button></td>`
              );
            } else if (type === "denied") {
              newRow.append(
                `<td><button style="${acceptButtonStyle}" onclick="acceptBooking(${index}, '${tableId}','${dataDenied}')" data-index="${index}" id="act">Accept</button></td>`
              );
            } else if (type === "cancelled") {
              let viewDetailsButtonStyle =
                "background-color: #ffaf00; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;";
              newRow.append(
                `<td><button style="${viewDetailsButtonStyle}" id="view" >View</button></td>`
              );
            }

            tbody.append(newRow);
          }
        });

        return table;
      };

      const getUsers = async () => {
        try {
          const userRecords = await fetch(API_LOCAL + "/allUsers", {
            credentials: "include",
          });
          if (userRecords.status == 401) {
            location.href = "/login/";
            return;
          }
          const userData = await userRecords.json();
          $("#animation-table").remove();
          allUsers = userData;

          const newTable = createUsers(userData, currentState);
          // Clear existing table data
          $(".table-responsive").empty();

          // Append the new table to the table-responsive div
          $(".table-responsive").append(newTable);

          // Initialize DataTable for the new table
          initializeDataTable(`admin-${currentState}-records`);
        } catch (error) {
          console.log(error);
          // Handle errors
        }
      };

      // Function to fetch and display data in the table
      const fetchAndDisplayData = async () => {
        try {
          // Fetch data from the API based on the selected type
          const response = await fetch(API_LOCAL + "/admin", {
            credentials: "include",
          });
          if (response.status == 401) {
            location.href = "/login/";
            return;
          }
          const data = await response.json();
          $("#animation-table").remove();
          // Assuming data structure is consistent
          dataPending = data.pendingBookings;
          dataAllowed = data.acceptedBookings;
          dataDenied = data.deniedBookings;
          dataCancelled = data.cancelledBookings;

          console.log(data);

          // Create a new table with fetched data
          const newTable = createTable(
            data[`${currentState}Bookings`],
            currentState
          );

          // Clear existing table data
          $(".table-responsive").empty();

          // Append the new table to the table-responsive div
          $(".table-responsive").append(newTable);

          // Initialize DataTable for the new table
          initializeDataTable(`admin-${currentState}-records`);
        } catch (error) {
          console.log(error);
          // Handle errors
        }
      };

      // Initial fetch and display of pending data
      $(document).ready(function () {
        fetchAndDisplayData();

        // Fetch and display pending data initially
      });

      // Click event handlers for navigation links
      $(document).ready(function () {
        // Click event handler for pending link
        $("#navbar li:nth-child(4)").click(function () {
          $("#recordsTitle").text("Pending Records");

          if (currentState != "pending") {
            // console.log(currentState)
            setCurrentState("pending");
            fetchAndDisplayData();

            updateTable(dataPending, "pending");
          }
        });

        // Click event handler for accepted link
        $("#navbar li:nth-child(5)").click(function () {
          $("#recordsTitle").text("Accepted Records");

          if (currentState != "accepted") {
            setCurrentState("accepted");

            fetchAndDisplayData();
            // console.log(currentState)
            updateTable(dataAllowed, "accepted");
          }
        });

        // Click event handler for denied link
        $("#navbar li:nth-child(6)").click(function () {
          $("#recordsTitle").text("Denied Records");

          if (currentState != "denied") {
            // console.log(currentState)

            setCurrentState("denied");

            fetchAndDisplayData();
            // updateTable(dataDenied, 'denied');
          }
        });

        $("#navbar li:nth-child(9)").click(function () {
          $("#recordsTitle").text("Users List");

          if (currentState != "allUsers") {
            // console.log(currentState)

            setCurrentState("allUsers");
            getUsers();

            // fetchAndDisplayData();
            // updateTable(allUsers, 'allUsers');
          }
        });

        $("#navbar li:nth-child(10)").click(function () {
          $("#recordsTitle").text("Cancelled Events");

          if (currentState != "cancelled") {
            // console.log(currentState)

            setCurrentState("cancelled");
            fetchAndDisplayData();

            // fetchAndDisplayData();
            updateTable(dataCancelled, "cancelled");
          }
        });
      });

      // Function to initialize DataTable for the table with given ID
       const initializeDataTable = (tableId) => {
        $(`#${tableId}`).DataTable({
          language: {
            paginate: {
              next: ">>",
              previous: "<<",
            },
          },
          dom: '<"top"pfl<"clear">>rt<"bottom"ip<"clear">>',
        });
      };

      // // Function to update the table with given data and type
      const updateTable = (bookings, type) => {
        // Check if the table already exists

        $("#hall-name-filter").val("all");
        $("#dept-filter").val("all");
        $("#start-date").val("");
        $("#end-date").val("");
        $("#food-dropdown input:checked").prop("checked", false);
        const tableExists = $(`#admin-${type}-records`).length > 0;

        // If the table already exists, replace its contents
        if (tableExists) {
          // console.log("if")
          // Destroy the existing DataTable instance

          $(`#admin-${type}-records`).DataTable().destroy();
          if (type === "allUsers") {
            // console.log(type)
            const newTable = createUsers(bookings, type);
            $(`#admin-${type}-records`).replaceWith(newTable);
            initializeDataTable(`admin-${type}-records`);
          } else {
            const newTable = createTable(bookings, type);
            $(`#admin-${type}-records`).replaceWith(newTable);
            initializeDataTable(`admin-${type}-records`);
          }
        } else {
          if (type === "allUsers") {
            // console.log(type,bookings)
            const newTable = createUsers(bookings, type);
            $(".table-responsive").empty().append(newTable);
            initializeDataTable(`admin-${type}-records`);
          } else {
            const newTable = createTable(bookings, type);
            $(".table-responsive").empty().append(newTable);
            initializeDataTable(`admin-${type}-records`);
          }

          // console.log(newTable)
        }
      };

      const filterTableData = () => {
        const hallName = $("#hall-name-filter").val();
        const dept = $("#dept-filter").val();
        const startDate = $("#start-date").val();
        const endDate = $("#end-date").val();
        const selectedFood = [];

        // Get selected food options
        $("#food-dropdown input:checked").each(function () {
          selectedFood.push($(this).val());
        });

        const filteredData = [];
        // console.log(hallName)
        let dataToFilter;
        switch (currentState) {
          case "pending":
            dataToFilter = dataPending;
            break;
          case "accepted":
            dataToFilter = dataAllowed;
            break;
          case "denied":
            dataToFilter = dataDenied;
            break;
          case "cancelled":
            dataToFilter = dataCancelled;
            break;
          default:
            dataToFilter = [];
            break;
        }

        if (dataToFilter) {
          dataToFilter.forEach((booking) => {
            if (
              (hallName === "all" ||
                hallName === null ||
                booking.hallname === hallName) &&
              (dept === "all" || dept === null || booking.dept === dept) &&
              (startDate === "" ||
                startDate === null ||
                new Date(booking.date) >= new Date(startDate)) &&
              (endDate === "" ||
                endDate === null ||
                new Date(booking.date) <=
                  new Date(endDate).setHours(23, 59, 59)) &&
              (selectedFood.length === 0 ||
                selectedFood.some((food) => booking.food.includes(food)))
            ) {
              const originalIndex = dataToFilter.findIndex(
                (item) => item === booking
              );

              filteredData.push({ booking, originalIndex });
            }
          });
          // console.log(filteredData)
        }

        // Clear existing table data
        $(`#admin-${currentState}-records tbody`).empty();

        // Create the table
        const table = $("<table>")
          .attr("id", `admin-${currentState}-records`)
          .addClass("display data-table")
          .css("width", "100%");

        // Create the table header
        const thead = $("<thead>").appendTo(table);
        $("<tr>")
          .appendTo(thead)
          .append("<th>No</th>")
          .append("<th>Hall name</th>")
          .append("<th>Name</th>")
          .append("<th>Dept</th>")
          .append("<th>Date</th>")
          .append("<th>Start Time</th>")
          .append("<th>End Time</th>")
          .append("<th>Seats</th>")
          .append("<th>Event Name</th>")
          .append("<th>Purpose</th>")
          .append("<th>Refresh For</th>")
          .append("<th>Refresh Type</th>")
          .append("<th>Food</th>");

        if (currentState === "pending") {
          thead.find("tr").append("<th>Accept</th>").append("<th>Reject</th>");
        } else if (currentState === "accepted") {
          thead.find("tr").append("<th>Reject</th>");
        } else if (currentState === "denied") {
          thead.find("tr").append("<th>Accept</th>");
        }

        // Create the table body
        const tbody = $("<tbody>").appendTo(table);

        // Populate table with filtered data
        const currentDate = new Date();
        currentDate.setHours(0, 0, 0, 0);
        filteredData.forEach(({ booking, originalIndex }) => {
          const bookingDate = new Date(booking.date);
          if (bookingDate >= currentDate) {
            const newRow = $("<tr>");

            newRow.append(`<td>${originalIndex + 1}</td>`);
            newRow.append(`<td>${booking.hallname}</td>`);
            newRow.append(`<td>${booking.name}</td>`);
            newRow.append(`<td>${booking.dept}</td>`);
            newRow.append(
              `<td>${new Date(booking.date).toLocaleDateString("en-GB")}</td>`
            );
            newRow.append(
              `<td>${new Date(booking.starttime).getUTCHours() % 12 || 12}:${
                (new Date(booking.starttime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.starttime).getUTCMinutes()
              } ${
                new Date(booking.starttime).getUTCHours() < 12 ? "AM" : "PM"
              }</td>`
            );
            newRow.append(
              `<td>${new Date(booking.endtime).getUTCHours() % 12 || 12}:${
                (new Date(booking.endtime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.endtime).getUTCMinutes()
              } ${
                new Date(booking.endtime).getUTCHours() < 12 ? "AM" : "PM"
              }</td>`
            );
            newRow.append(`<td>${booking.seating}</td>`);
            newRow.append(`<td>${booking.eventname}</td>`);
            newRow.append(`<td>${booking.purpose.toLowerCase()}</td>`);
            newRow.append(`<td>${booking.refreshmentfor.toLowerCase()}</td>`);
            newRow.append(`<td>${booking.refreshmenttype.toLowerCase()}</td>`);
            newRow.append(`<td>${booking.food.join(" ")}</td>`);
            // Add other columns
            // ...

            if (currentState === "pending") {
              let acceptButtonStyle = "";
              if (booking.status === "denied_temp") {
                acceptButtonStyle =
                  "background-color: #009150; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;opacity: 0.5;cursor: not-allowed;";
                newRow.append(
                  `<td><button style="${acceptButtonStyle}">Accept</button></td>`
                );
              } else {
                acceptButtonStyle =
                  "background-color: #009150; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;";
                newRow.append(
                  `<td><button style="${acceptButtonStyle}" onclick="acceptBooking(${originalIndex}, 'admin-${currentState}-records', '${currentState}')" data-index="${originalIndex}" id="act">Accept</button></td>`
                );
              }
              newRow.append(
                `<td><button style="${rejectButtonStyle}" onclick="rejectBooking(${index}, '${tableId}', '${dataPending}')" data-index="${index}" id="rej">Reject</button></td>`
              );
            } else if (currentState === "accepted") {
              newRow.append(
                `<td><button style="${rejectButtonStyle}" onclick="rejectBooking(${originalIndex}, 'admin-${currentState}-records', '${currentState}')" data-index="${originalIndex}" id="rej">Reject</button></td>`
              );
            } else if (currentState === "denied") {
              newRow.append(
                `<td><button style="${acceptButtonStyle}" onclick="acceptBooking(${originalIndex}, 'admin-${currentState}-records', '${currentState}')" data-index="${originalIndex}" id="act">Accept</button></td>`
              );
            }

            tbody.append(newRow);
          }
        });

        // Append the new table to the table-responsive div
        $(".table-responsive").empty().append(table);

        // Initialize DataTable for the new table
        $(`#admin-${currentState}-records`).DataTable();
      };

      // Event listener for filter options
      $(".table-filter").change(function () {
        filterTableData(); // Filter table data when filter options change
      });

      // Initial filter of table data
      // $(document).ready(function () {
      //   filterTableData();
      //   // updateTable(dataPending, 'pending');

      //    // Filter table data initially
      // });

      // Initial filter of table data
      // $(document).ready(function () {
      //   getUsers();
      // });

      // Function to accept a booking
      const acceptBooking = async (index, tableId, currData) => {
        let correctId;
        if (tableId === "admin-pending-records") {
          currData = dataPending;
          correctId = "pendingBookings";
        }
        if (tableId === "admin-denied-records") {
          currData = dataDenied;
          correctId = "deniedBookings";
        }
        // console.log(index)
        const button = $(`#${tableId} button#act[data-index="${index}"]`);
        console.log(button, index, tableId);
        button.prop("disabled", true); // Disable the button to prevent multiple clicks
        button.html("Accepting..."); // Change button text to Loading...
        button.css({
          transition: "background-color 0.3s ease",
          backgroundColor: "rgba(0, 0, 0, 0.5)", // Fade the button to a semi-transparent black color
        });

        const email = currData[index].email;
        const hallName = currData[index].hallname;
        const date = currData[index].date;
        const startTime = currData[index].starttime;
        const endTime = currData[index].endtime;
        const currentStatus = currData[index].status;

        // console.log(index,currData[index])

        // console.log(currData[index].email,currData[index].hallname,currData[index].date)

        try {
          // Send request to update the status to accepted
          const response = await fetch(API_LOCAL + "/modify", {
            mode: "cors",
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              currentStatus: currentStatus,
              updateStatus: "accepted",
              email,
              hallName,
              date,
              startTime,
              endTime,
            }),
            credentials: "include",
          });
          if (response.status == 401) {
            location.href = "/login/";
            return;
          }

          if (response.ok) {
            // Find the parent row of the button and remove it
            // const row = $(`#${tableId} tbody tr`).eq(index);
            // console.log(row)
            fetchAndDisplayData();
            // updateTable(originalData,currentStatus)
            console.log("table is updated");
          } else {
            console.error("Failed to update booking status.");
          }
          // console.log(got)
          // console.log(originalData)
        } catch (error) {
          console.error("Error while updating booking status:", error);
        }
      };

      // Function to reject a booking
      const rejectBooking = async (index, tableId, currData) => {
        let correctId;
        if (tableId === "admin-pending-records") {
          currData = dataPending;
          correctId = "pendingBookings";
        }
        if (tableId === "admin-accepted-records") {
          currData = dataAllowed;
          correctId = "acceptedBookings";
        }

        const button = $(`#${tableId} button#rej[data-index="${index}"]`);
        console.log(button, index, tableId);
        button.prop("disabled", true); // Disable the button to prevent multiple clicks
        button.html("Rejecting..."); // Change button text to Loading...
        button.css({
          transition: "background-color 0.3s ease",
          backgroundColor: "rgba(0, 0, 0, 0.5)", // Fade the button to a semi-transparent black color
        });

        const email = currData[index].email;
        const hallName = currData[index].hallname;
        const date = currData[index].date;
        const startTime = currData[index].starttime;
        const endTime = currData[index].endtime;
        const currentStatus = currData[index].status;

        // console.log(index,currData[index])
        // console.log(currData[index].email,currData[index].hallname,currData[index].date)

        try {
          // Send request to update the status to denied
          const response = await fetch(API_LOCAL + "/modify", {
            mode: "cors",
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              currentStatus: currentStatus,
              updateStatus: "denied",
              email,
              hallName,
              date,
              startTime,
              endTime,
            }),
            credentials: "include",
          });
          if (response.status == 401) {
            location.href = "/login/";
            return;
          }

          if (response.ok) {
            // Find the parent row of the button and remove it
            // const row = $(`#${tableId} tbody tr`).eq(index);
            fetchAndDisplayData();
          } else {
            console.error("Failed to update booking status.");
          }
        } catch (error) {
          console.error("Error while updating booking status:", error);
        }
      };

      $(document).ready(function () {
        // Event listener for list items
        $("#navbar li:not(#dashboardLink, #userLink,#tableLink)").click(
          function () {
            // Remove active class from all list items
            $("#navbar li").removeClass("active");

            // Add active class to the clicked list item

            $(this).addClass("active");

            // Apply animation
            $(this).css({ transform: "translateY(3px)" });
            setTimeout(() => {
              $(this).css({ transform: "translateY(0)" });
            }, 200);
          }
        );
      });

      $(document).on("click", "#view", async function () {
        const index = $(this).closest("tr").index(); // Get the index of the clicked row
        const booking = dataCancelled[index]; // Get the booking data for the clicked row

        $("#myModalLabel").text("Reason for event failed"); // Update the modal title

        // Update the modal body with the reason from the booking data
        $(".modal-body").html(
          `Event has been cancelled because ${booking.reason}.`
        );

        $("#myModal").modal("show"); // Show the modal popup
      });

      $("#closeModalBtn").click(function () {
        $("#myModal").modal("hide");
      });
      $("#crossBtnaccepted").click(function () {
        $("#myModal").modal("hide");
      });

      $(document).ready(function () {
        $("#logout").on("click", function () {
          var logoutModal = $("#logoutModal");
          logoutModal.modal("show");
        });

        $("#logoutModal").on("shown.bs.modal", function () {
          $(this)
            .find(".modal-dialog")
            .addClass("animate__animated animate__bounceIn");
        });

        // Handle confirm logout button click
        $("#closelogout").on("click", function () {
          $("#logoutModal").modal("hide"); // Close the modal
        });

        $("#crosslogout").on("click", function () {
          $("#logoutModal").modal("hide"); // Close the modal
        });

        $("#confirmLogout").on("click", async function () {
          $("#logoutModal").modal("hide"); // Close the modal
          const res = await fetch(API_LOCAL + "/logout", {
            credentials: "include", // Include cookies with the request
            headers: {
              "Content-Type": "application/json",
            },
          });
          if (res.status == 200) {
            location.href = "/login/";
          }
          ClearHistory();
          function ClearHistory() {
            var backlen = history.length;
            history.go(-backlen);
            connectFirestoreEmulator.log(history.length);
            window.location.href = "/login/";
          }
        });
      });
    </script>

    <!-- Include jQuery UI CSS -->
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css"
    />

    <!-- Include jQuery UI JavaScript -->
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>

    <!-- Include Boxicons CSS -->
    <link
      href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css"
      rel="stylesheet"
    />

    <script>
      let currentState = "pending";

      const downloadExcel = (tableid) => {
        // console.log(tableid);
        const originalTable = $(`#${tableid}`).DataTable();

        if (originalTable.rows().count() === 0) {
          console.log("Table is empty. Cannot download Excel.");
          alert("Table is empty. Cannot download Excel.");
          return;
        }
        // Disable pagination
        originalTable.page.len(-1).draw();

        // Convert the table to Excel
        const workbook = XLSX.utils.table_to_book(
          originalTable.table().node(),
          { sheet: "Sheet 1" }
        );
        const excelBuffer = XLSX.write(workbook, {
          bookType: "xlsx",
          type: "array",
        });
        const blob = new Blob([excelBuffer], {
          type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
        });
        saveAs(blob, `${tableid}.xlsx`);

        // Re-enable pagination
        originalTable.page.len(10).draw();
      };

      const setCurrentState = (state) => {
        currentState = state;
        // console.log(currentState)
      };

      const downloadBasedOnState = () => {
        if (currentState === "pending") {
          downloadExcel("admin-pending-records");
        } else if (currentState === "accepted") {
          downloadExcel("admin-accepted-records");
        } else if (currentState === "denied") {
          downloadExcel("admin-denied-records");
        } else if (currentState === "allUsers") {
          downloadExcel("admin-allUsers-records");
        } else if (currentState === "cancelled") {
          downloadExcel("admin-cancelled-records");
        }
      };

      $(document).ready(function () {
        // Initialize datepicker for Start Date input
        $("#start-date").datepicker({
          dateFormat: "yy/mm/dd", // Day, Month, Year format
          onSelect: function () {
            // Trigger filtering function when a date is selected
            filterTableData();
          },
        });

        // Initialize datepicker for End Date input
        $("#end-date").datepicker({
          dateFormat: "yy/mm/dd", // Day, Month, Year format
          onSelect: function () {
            // Trigger filtering function when a date is selected
            filterTableData();
          },
        });
      });
    </script>

    <style>
      .filter-options {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
      }

      .filter-options > * {
        margin-bottom: 1rem; /* Add some spacing between each filter option */
      }

      .filter-options input[type="text"] {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        outline: none;
        width: 200px;
      }

      .filter-options input[type="text"]:focus,
      .filter-options select:focus {
        border-color: #007bff; /* Change border color on focus */
      }

      .filter-options select {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        outline: none;
        /* width: 150px;  */
      }

      /* Dropdown Button */
      .dropbtn {
        background-color: rgb(255, 255, 255);
        border: 1px solid #ddd;
        color: black;
        padding: 10px;
        font-size: 14px;
        border-radius: 4px;
        cursor: pointer;
      }

      /* Dropdown Content (Hidden by Default) */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
        z-index: 1;
        padding: 10px;
        border-radius: 4px;
        border: 1px solid #c5c5c5;
        overflow-y: auto;
      }

      /* Show the dropdown content on hover */
      .dropdown:hover .dropdown-content {
        display: block;
      }
    </style>

    <style>
       .dataTables_filter input[type="search"] {
        border: 1px solid #ccc;
        padding: 7px;
        border-radius: 20px;
        margin-right: 10px;
      }
    </style>
  </body>
</html>
