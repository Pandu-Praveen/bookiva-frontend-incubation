<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/images/icon2.png" />
    <!-- Boxicons -->
    <link
      href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css"
      rel="stylesheet"
    />
    <!-- My CSS -->
    <link rel="stylesheet" href="/management.css" />

    <title>Management</title>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css"
    />
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

    <!-- SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
  </head>
  <body>
    <!-- SIDEBAR -->
    <section id="sidebar">
      <a href="#" class="brand">
        <i class="bx bxs-home" style="color: black"></i>
        <!-- <img src="/images/icon2.png" alt="" style="width: 20px" />
        <img
          src="/images/bookiva2.png"
          alt=""
          style="width: 130px; margin-top: 5px; margin-left: 5px"
        /> -->
        <img src="/images/bookiva4.png" alt="" style="width: 130px" />
      </a>
      <ul class="side-menu top">
        <li class="active">
          <a href="#">
            <i class="bx bxs-dashboard"></i>
            <span class="text">Dashboard</span>
          </a>
        </li>

        <li>
          <a href="#">
            <i class="bx bxs-check-circle"></i>
            <span class="text">Completed Events</span>
          </a>
        </li>

        <li>
          <a href="#">
            <i class="bx bxs-hourglass"></i>
            <span class="text">Pending Events</span>
          </a>
        </li>
        <li>
          <a href="#">
            <i class="bx bxs-x-circle"></i>
            <span class="text">Cancelled Events</span>
          </a>
        </li>
        <li>
          <a href="#">
            <i class="bx bxs-bank"></i>
            <span class="text">Create new Hall</span>
          </a>
        </li>
      </ul>
      <ul class="side-menu">
        <li>
          <a href="/admin/index.html">
            <i class="bx bxs-user-detail"></i>
            <span class="text">Go to Admin</span>
          </a>
        </li>
        <li>
          <a href="/venues/index.html">
            <i class="bx bxs-cog"></i>
            <span class="text">Book the Hall</span>
          </a>
        </li>
        <li>
          <a href="#" class="logout">
            <i class="bx bxs-log-out-circle"></i>
            <span class="text">Logout</span>
          </a>
        </li>
      </ul>
    </section>
    <!-- SIDEBAR -->

    <!-- CONTENT -->
    <section id="content" class="ff-inter fs-s fw-500">
      <!-- NAVBAR -->
      <nav>
        <!-- <i class='bx bx-menu' ></i> -->
        <img
          src="https://cdn-icons-png.flaticon.com/128/6015/6015685.png"
          class="bx bx-menu"
          alt=""
          style="width: 25px"
        />
        <p class="nav-link">Management</p>
        <form action="#">
          <div class="form-input">
            <input
              type="search"
              placeholder="Search..."
              style="display: none"
            />
            <button type="submit" class="search-btn" style="display: none">
              <i class="bx bx-search"></i>
            </button>
          </div>
        </form>

        <!-- <input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label> -->
        <!-- <a href="#" class="notification">
				<i class='bx bxs-bell' ></i>
				<span class="num">8</span>
			</a> -->
        <a href="#" class="profile">
          <img
            src="https://cdn-icons-png.flaticon.com/128/9131/9131646.png"
            alt=""
          />
        </a>
      </nav>
      <!-- NAVBAR -->

      <!-- MAIN -->
      <main>
        <div class="head-title">
          <div class="left">
            <h1>Dashboard</h1>
            <!-- <ul class="breadcrumb">
						<li>
							<a href="#">Dashboard</a>
						</li>
						<li><i class='bx bx-chevron-right' ></i></li>
						<li>
							<a class="active" href="#">Home</a>
						</li>
					</ul> -->
          </div>
          <!-- <a href="#" class="btn-download" id="download-pdf">
					<i class='bx bxs-cloud-download' ></i>
					<span class="text">Download PDF</span>
				</a> -->
          <!-- Add this button inside your HTML -->
          <a href="#" class="btn-download" id="download-logs">
            <i class="bx bxs-cloud-download"></i>
            <span class="text">Download Logs</span>
          </a>
        </div>

        <ul class="box-info">
          <li>
            <i class="bx bxs-user" style="color: rgba(47, 102, 255, 0.793)"></i>
            <span class="text">
              <h3>50</h3>
              <p>Beneficiary Count</p>
            </span>
          </li>

          <li>
            <i
              class="bx bxs-calendar-check"
              style="color: rgba(0, 128, 0, 0.729)"
            ></i>
            <span class="text">
              <h3>40</h3>
              <p>Completed Events Count</p>
            </span>
          </li>
          <li>
            <i class="bx bxs-alarm"></i>
            <span class="text">
              <h3>10</h3>
              <p>Pending Events Count</p>
            </span>
          </li>
          <li>
            <i class="bx bxs-x-circle"></i>
            <span class="text">
              <h3>0</h3>
              <p>Failed Events Count</p>
            </span>
          </li>
          <li>
            <i class="bx bx-loader-alt"></i>
            <span class="text">
              <h3>15</h3>
              <p>Not turned in</p>
            </span>
          </li>
        </ul>

        <div class="table-data">
          <div class="order">
            <div class="head">
              <h3 id="topic">Event Performance</h3>
              <!-- <i class='bx bx-search' ></i>
						<i class='bx bx-filter' ></i> -->
            </div>

            <div class="filter-options" style="display: none">
              <label for="filter" style="font-weight: bold; font-size: 15px"
                >Filter By:</label
              >

              <select id="hall-name-filter" class="table-filter">
                <option value="all" disabled selected>Hall Name</option>
                <option value="all" style="font-weight: bold">None</option>
                <option value="Alpha Hall" id="alpha">Alpha Hall</option>
                <option value="Beta Hall">Beta Hall</option>
                <option value="Gamma Hall">Gamma Hall</option>
                <option value="Sigma Hall">Sigma Hall</option>
                <option value="Leo Muthu">Leo Muthu</option>
                <option value="VRR Hall">VRR Hall</option>
                <option value="SSR Hall">SSR Hall</option>
                <option value="SIT AV Hall">SIT AV Hall</option>
                <option value="SIT Smart Classroom">SIT Smart Classroom</option>
                <option value="SEC AV Hall">SEC AV Hall</option>
                <!-- Add options for Hall Name filtering -->
              </select>

              <select id="college-filter" class="table-filter">
                <option value="all" disabled selected>College</option>
                <option value="all" style="font-weight: bold">None</option>
                <option value="SEC">SEC</option>
                <option value="SIT">SIT</option>
                <!-- Add options for College filtering -->
              </select>

              <select id="dept-filter" class="table-filter">
                <option value="all" disabled selected>Department</option>
                <option value="all" style="font-weight: bold">None</option>
                <option value="AIDS">AIDS</option>
                <option value="CCE">CCE</option>
                <option value="CIVIL">CIVIL</option>
                <option value="CSE">CSE</option>
                <option value="CYBER">CYBER</option>
                <option value="ECE">ECE</option>
                <option value="EEE">EEE</option>
                <option value="ICE">ICE</option>
                <option value="IEI">IEI</option>
                <option value="IOT">IOT</option>
                <option value="IT">IT</option>
                <option value="MBA">MBA</option>
                <option value="MECH">MECH</option>

                <!-- Add options for Department filtering -->
              </select>

              <input
                type="text"
                id="start-date"
                class="table-filter"
                placeholder="Start Date"
              />
              <input
                type="text"
                id="end-date"
                class="table-filter"
                placeholder="End Date"
              />
            </div>
            <br /><br />

            <div
              id="completed-events-table"
              style="display: none; font-weight: lighter"
              class="ff-inter fs-s fw-600"
            >
              <table>
                <thead>
                  <tr>
                    <th>No.</th>
                    <th>Hall Name</th>
                    <th>Staff Name</th>
                    <th>College</th>
                    <th>Dept</th>
                    <th>Email</th>
                    <th>Event</th>
                    <th>Date</th>
                    <th>Purpose</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div
              id="pending-events-table"
              style="display: none; font-weight: lighter"
              class="ff-inter fs-s fw-600"
            >
              <table>
                <thead>
                  <tr>
                    <th>No.</th>
                    <th>Hall Name</th>
                    <th>Staff Name</th>
                    <th>College</th>
                    <th>Dept</th>
                    <th>Email</th>
                    <th>Event</th>
                    <th>Date</th>
                    <th>Purpose</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div
              id="failed-events-table"
              style="display: none; font-weight: lighter"
              class="ff-inter fs-s fw-600"
            >
              <table>
                <thead>
                  <tr>
                    <th>No.</th>
                    <th>Hall Name</th>
                    <th>Staff Name</th>
                    <th>College</th>
                    <th>Dept</th>
                    <th>Email</th>
                    <th>Event</th>
                    <th>Date</th>
                    <th>Purpose</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div id="chart"></div>
          </div>

          <div class="todo">
            <div class="head">
              <h3>Admin List</h3>
              <!-- <i class='bx bx-plus' ></i> -->
              <div class="dropdown">
                <i class="bx bx-plus dropbtn"></i>
                <i class="bx bxs-arrow-from-left makeAdmin"></i>

                <div
                  id="myModal"
                  class="dropdown-content"
                  style="display: none"
                >
                  <p style="font-weight: bold; text-align: center">
                    Create New Admin
                  </p>
                  <br />
                  <div class="modal-content">
                    <form id="adminForm">
                      <label for="adminName">Name:</label>
                      <input
                        type="text"
                        id="adminName"
                        name="adminName"
                        required
                      /><br />
                      <label for="adminEmail">Email:</label>
                      <input
                        type="email"
                        id="adminEmail"
                        name="adminEmail"
                        required
                      /><br />
                      <button type="submit" id="addAdmin">Add Admin</button>
                    </form>
                  </div>
                </div>

                <div
                  id="myModal"
                  class="makeAdmin-content"
                  style="display: none"
                >
                  <p style="font-weight: bold; text-align: center">
                    Change to Admin
                  </p>
                  <br />
                  <div class="modal-content">
                    <form id="makeAdminForm">
                      <label for="adminEmail">Email:</label>
                      <input
                        type="email"
                        id="makeAdminEmail"
                        name="makeAdminEmail"
                        required
                      /><br />
                      <button type="submit" id="addAdmin">Add Admin</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>

            <ul class="todo-list">
              <!-- <li class="completed">
							<p>Admin 1</p>
							<i class='bx bxs-trash'></i>
						</li>
						<li class="completed">
							<p>Admin 2</p>
							<i class='bx bxs-trash'></i>
						</li>
						<li class="not-completed">
							<p>Admin 3</p>
							<i class='bx bxs-trash'></i>
						</li>
						<li class="completed">
							<p>Admin 4</p>
							<i class='bx bxs-trash-alt' ></i>
						</li>
						<li class="not-completed">
							<p>Admin 5</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li> -->
            </ul>
          </div>
        </div>

        <div class="makehall" style="display: none">
          <h1 class="form-title">Enter Hall Details</h1>
          <form id="createHallForm">
            <div class="main-user-info">
              <div class="user-input-box">
                <label for="fullName">Hall Name</label>
                <input
                  type="text"
                  id="hallname"
                  name="hallname"
                  placeholder="Hall Name"
                  required
                />
              </div>
              <div class="user-input-box">
                <label for="username">Campus Name</label>
                <select name="campusname" id="campusname" required>
                  <option disabled selected>Select</option>
                  <option value="Sri SaiRam Engineering College">
                    Sri SaiRam Engineering College
                  </option>
<!--                   <option value="Sri SaiRam Institute Of Technology">
                    Sri SaiRam Institute Of Technology
                  </option> -->
                </select>
              </div>
              <div class="user-input-box">
                <label for="email">Hall Location</label>
                <input
                  type="text"
                  id="location"
                  name="location"
                  placeholder="Location"
                  required
                />
              </div>
              <div class="user-input-box">
                <label for="phoneNumber">Projector Available</label>
                <select
                  id="projectoravailable"
                  name="projectoravailable"
                  required
                >
                  <option value="yes" selected>Yes</option>
                  <option value="no">No</option>
                </select>
              </div>
              <div class="user-input-box">
                <label for="acavailable">AC available</label>
                <select id="acavailable" name="acavailable" required>
                  <option value="yes" selected>Yes</option>
                  <option value="no">No</option>
                </select>
              </div>

              <div class="user-input-box">
                <label for="confirmPassword">Seating Capacity</label>
                <input
                  type="number"
                  id="seatingcapacity"
                  name="seatingcapacity"
                  placeholder="ex: 100"
                  required
                />
              </div>
              <div class="user-input-box">
                <label for="confirmPassword">Currently Available</label>
                <select
                  id="currentlyavailable"
                  name="currentlyavailable"
                  required
                >
                  <option value="yes" selected>Yes</option>
                  <option value="no">No</option>
                </select>
              </div>

              <div class="user-input-box">
                <label for="confirmPassword"
                  >Upload Hall Image (select atleast 3 images)</label
                >
                <input
                  id="file-upload"
                  type="file"
                  name="images"
                  accept="image/*"
                  multiple
                  required
                />
              </div>
            </div>
            <!-- <div class="gender-details-box">
					<span class="gender-title">Gender</span>
					<div class="gender-category">
					  <input type="radio" name="gender" id="male">
					  <label for="male">Male</label>
					  <input type="radio" name="gender" id="female">
					  <label for="female">Female</label>
					  <input type="radio" name="gender" id="other">
					  <label for="other">Other</label>
					</div>
				  </div> -->
            <div class="form-submit-btn">
              <input type="submit" value="Create Hall" />
            </div>
          </form>
        </div>
      </main>
      <!-- MAIN -->
    </section>

    <!-- CONTENT -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <script src="https://cdn.jsdelivr.net/npm/apexcharts/dist/modules/export.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts/dist/modules/export.min.js"></script>

    <script>
      // Sample data for completed, pending, and not completed events by month
	  
      
      let eventData = [
        {
          month: "January",
          Beneficiary: 10,
          completed: 30,
          pending: 20,
          notCompleted: 10,
          notTurnedIn: 100,
        },
        {
          month: "February",
          Beneficiary: 0,
          completed: 50,
          pending: 25,
          notCompleted: 15,
          notTurnedIn: 5,
        },
        {
          month: "March",
          Beneficiary: 0,
          completed: 35,
          pending: 30,
          notCompleted: 10,
          notTurnedIn: 205,
        },
        {
          month: "April",
          Beneficiary: 0,
          completed: 50,
          pending: 35,
          notCompleted: 25,
          notTurnedIn: 5,
        },
        {
          month: "May",
          Beneficiary: 0,
          completed: 49,
          pending: 130,
          notCompleted: 30,
          notTurnedIn: 5,
        },
        {
          month: "June",
          Beneficiary: 0,
          completed: 61,
          pending: 45,
          notCompleted: 35,
          notTurnedIn: 5,
        },
        {
          month: "July",
          Beneficiary: 10,
          completed: 70,
          pending: 50,
          notCompleted: 50,
          notTurnedIn: 5,
        },
        {
          month: "August",
          Beneficiary: 0,
          completed: 110,
          pending: 55,
          notCompleted: 45,
          notTurnedIn: 5,
        },
        {
          month: "September",
          Beneficiary: 0,
          completed: 125,
          pending: 60,
          notCompleted: 50,
          notTurnedIn: 5,
        },
        {
          month: "October",
          Beneficiary: 0,
          completed: 110,
          pending: 55,
          notCompleted: 45,
          notTurnedIn: 5,
        },
        {
          month: "November",
          Beneficiary: 30,
          completed: 110,
          pending: 75,
          notCompleted: 45,
          notTurnedIn: 5,
        },
        {
          month: "December",
          Beneficiary: 0,
          completed: 110,
          pending: 55,
          notCompleted: 45,
          notTurnedIn: 5,
        },
      ];

      let months = eventData.map((data) => data.month);
      let beneficiaryData = eventData.map((data) => data.Beneficiary);
      let completedData = eventData.map((data) => data.completed);
      let pendingData = eventData.map((data) => data.pending);
      let notCompletedData = eventData.map((data) => data.notCompleted);
      let notTurnedInData = eventData.map((data) => data.notTurnedIn);
      console.log(notTurnedInData);
      let colors = ["#318CE7", "#2ECC71", "#FEBE10", "#E74C3C", "#000000"];

      let options = {
        chart: {
          type: "line",
        },
        //Blue for Beneficiary, Green for completed, yellow for pending, red for not completed
        stroke: {
          curve: "smooth",
        },
        series: [
          {
            name: "Beneficiary",
            data: beneficiaryData,
          },
          {
            name: "Completed",
            data: completedData,
          },
          {
            name: "Pending",
            data: pendingData,
          },
          {
            name: "Not Completed",
            data: notCompletedData,
          },
          {
            name: "Not Turned in",
            data: notTurnedInData,
          },
        ],
        xaxis: {
          categories: months,
        },
      };

      var chart = new ApexCharts(document.querySelector("#chart"), options);
      chart.render();

      // Add the provided JavaScript code here
      document.addEventListener("DOMContentLoaded", function () {
        colors = ["#318CE7", "#2ECC71", "#FEBE10", "#E74C3C", "#6f00ff"];
        // Define event handlers for each box
        document
          .querySelectorAll(".box-info li")
          .forEach(function (box, index) {
            box.addEventListener("click", function () {
              // Reset active class for all boxes
              document.querySelectorAll(".box-info li").forEach(function (box) {
                box.classList.remove("active");
              });

              // Add active class to the clicked box
              box.classList.add("active");
              let paragraphText = box.querySelector("p").textContent;
              const topic = document.querySelector("#topic");
              topic.innerHTML = paragraphText;
              // console.log(paragraphText);

              // Update the chart based on the clicked box
              updateChart(index);
            });
          });

        // Function to update the chart based on the selected box
        function updateChart(index) {
          let newData;
          let indname;
          switch (index) {
            case 0: // Beneficiary Count
              newData = beneficiaryData;
              indname = "Beneficiary";
              break;
            case 1: // Completed Events Count
              newData = completedData;
              indname = "Completed";
              break;
            case 2: // Pending Events Count
              newData = pendingData;
              indname = "Pending";
              break;
            case 3: // Failed Events Count
              newData = notCompletedData;
              indname = "Failed";
              break;
            case 4: // Failed Events Count
              newData = notTurnedInData;
              indname = "Not Turned in";
              break;

            default:
              newData = [];
          }
          // console.log(index);
          chart.updateOptions({
            colors: [colors[index]], // Update colors array with the selected color
          });

          chart.updateSeries([
            {
              data: newData,
              name: indname,
            },
          ]);
        }
      });
    </script>

    <style>
      .dropdown {
        position: relative; /* Ensure the button is positioned relative to its parent */
      }

      .dropbtn {
        background-color: rgb(255, 255, 255);
        border: 1px solid #ddd;
        color: black;
        padding: 10px;
        font-size: 14px;
        border-radius: 4px;
        cursor: pointer;
      }
      .dropbtn:hover {
        background-color: rgb(255, 255, 255);
        border: 1px solid #ddd;
        color: black;
        padding: 10px;
        font-size: 14px;
        border-radius: 4px;
        cursor: pointer;
      }

      .makeAdmin {
        background-color: rgb(255, 255, 255);
        border: 1px solid #ddd;
        color: black;
        padding: 10px;
        font-size: 14px;
        border-radius: 4px;
        cursor: pointer;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
        z-index: 1;
        padding: 10px;
        border-radius: 4px;
        border: 1px solid #c5c5c5;
        overflow-y: auto;
        margin-left: -10rem; /* Adjust the margin as necessary */
        top: calc(100% + 10px); /* Position dropdown below the button */
        left: -70px; /* Align dropdown with the button */
        width: max-content; /* Allow the dropdown to expand based on content */
      }

      .dropdown-content.show {
        display: block;
      }

      .makeAdmin-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
        z-index: 1;
        padding: 10px;
        border-radius: 4px;
        border: 1px solid #c5c5c5;
        overflow-y: auto;
        margin-left: -10rem; /* Adjust the margin as necessary */
        top: calc(100% + 10px); /* Position dropdown below the button */
        left: -70px; /* Align dropdown with the button */
        width: max-content; /* Allow the dropdown to expand based on content */
      }

      .makeAdmin-content.show {
        display: block;
      }

      /* Style for the input boxes */
      .modal-content input[type="text"],
      .modal-content input[type="email"] {
        width: 100%; /* Ensure input boxes take full width */
        margin-bottom: 10px; /* Add some space between input boxes */
        padding: 10px; /* Add padding for better appearance */
        border: 1px solid #ccc; /* Add border */
        border-radius: 5px; /* Add border radius */
        font-size: 16px; /* Adjust font size */
        outline: none; /* Remove default focus outline */
      }

      /* Style for the submit button */
      .modal-content button[type="submit"] {
        background-color: #000000; /* Set button background color */
        color: #fff; /* Set text color */
        padding: 10px 20px; /* Add padding */
        border: none; /* Remove border */
        border-radius: 5px; /* Add border radius */
        font-size: 16px; /* Adjust font size */
        cursor: pointer; /* Add cursor pointer */
        outline: none; /* Remove default focus outline */
      }

      /* Style for the submit button on hover */
      .modal-content button[type="submit"]:hover {
        background-color: #707070; /* Darken button color on hover */
        color: white;
      }

      .pagination {
        margin-top: 10px;
        text-align: center;
      }

      .pagination button {
        margin: 0 5px;
        padding: 5px 10px;
        background-color: #000000;
        color: #fff;
        border: none;
        cursor: pointer;
        border-radius: 4px;
      }

      .pagination button:hover {
        background-color: #565656;
      }

      .filter-options {
        display: flex;
        gap: 1rem;
        align-items: center;
      }

      .filter-options select {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        outline: none;
      }

      .filter-options input[type="text"] {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        outline: none;
      }

      .filter-options input[type="text"]:focus,
      .filter-options select:focus {
        border-color: #007bff; /* Change border color on focus */
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>
    <script >

      const token =  Cookies.get("jwt");
      const API_LOCAL = "https://bookiva-backend-incubation.vercel.app";
      document.addEventListener("DOMContentLoaded", async function () {
        const response = await fetch(API_LOCAL + "/management", {
          mode: "cors",
          credentials: "include",
	  headers: {
            'Authorization': `Bearer ${token}`,
            "Content-Type": "application/json",
          }
        });
        // console.log(response)
        if (response.status == 401) {
          location.href = "/login/";
          return;
        }
      });

      document.addEventListener("DOMContentLoaded", function () {
        const dropbtn = document.querySelector(".dropbtn");
        const dropdownContent = document.querySelector(".dropdown-content");
        const adminForm = document.getElementById("adminForm");
        const todoList = document.querySelector(".todo-list");

        // Load admin details from localStorage on page load
        loadAdmins();

        dropbtn.addEventListener("click", function (event) {
          event.stopPropagation(); // Prevents the document click event from immediately closing the dropdown
          dropdownContent.style.display = "block";
          dropdownContent.classList.toggle("show");
          document.querySelector(".makeAdmin-content").style.display = "none";
        });

        // Close the dropdown when clicking outside of it
        document.addEventListener("click", function (event) {
          if (
            !event.target.matches(".dropbtn") &&
            !dropdownContent.contains(event.target)
          ) {
            dropdownContent.style.display = "none";
            dropdownContent.classList.remove("show");
          }
        });

        // Prevent the modal from closing when clicking inside the modal content
        dropdownContent.addEventListener("click", function (event) {
          event.stopPropagation();
        });

        // Prevent the modal from closing when clicking inside the input fields
        dropdownContent.querySelectorAll("input").forEach(function (input) {
          input.addEventListener("click", function (event) {
            event.stopPropagation();
          });
        });

        // Handle form submission
        adminForm.addEventListener("submit", async function (event) {
          event.preventDefault(); // Prevent the default form submission behavior

          // Get input values
          const adminName = document.getElementById("adminName").value;
          const adminEmail = document.getElementById("adminEmail").value;

          try {
            // Send request to create an admin
            const response = await fetch(API_LOCAL + "/addAdmin", {
              mode: "cors",
              method: "POST",
              headers: {
		'Authorization': `Bearer ${token}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ name: adminName, email: adminEmail }),
              credentials: "include",
            });

            if (response.status == 401) {
              location.href = "/login/";
              return;
            }

            if (response.status === 400) {
              alert("Admin already exists, kindly use another Email!");
            } else if (response.status === 200) {
              // Add admin to the todo list
              addAdminToList(adminName, adminEmail);
              // Save admin details to localStorage
              saveAdmins(adminName, adminEmail);
              // Clear input fields
              adminForm.reset();
              // Close dropdown
              dropdownContent.classList.remove("show");
            }
          } catch (error) {
            console.error("Error while adding an admin:", error);
          }
        });

        // Function to add admin to the todo list
        function addAdminToList(name, email) {
          // Create list item
          const listItem = document.createElement("li");
          listItem.classList.add("completed"); // Assuming newly added admins are marked as completed by default

          // Create paragraph element for admin details
          const adminDetails = document.createElement("p");
          adminDetails.textContent = `${name} (${email})`;

          // Create icon element
          const icon = document.createElement("i");
          icon.classList.add("bx", "bxs-trash-alt");
          icon.style.color = "#FF3800";
          icon.addEventListener("click", async function () {
            // Remove the list item when the icon is clicked
            todoList.removeChild(listItem);
            // Remove the admin from localStorage
            removeAdminFromStorage(name, email);

            try {
              const response = await fetch(API_LOCAL + "/removeAdmin", {
                mode: "cors",
                method: "POST",
                headers: {
		  'Authorization': `Bearer ${token}`,
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ name, email }),
                credentials: "include",
              });
              if (response.status == 401) {
                location.href = "/login/";
                return;
              }
              if (response.status !== 200) {
                console.error("Failed to remove admin from the backend");
              }
            } catch (error) {
              console.error("Error removing admin:", error);
            }
          });

          // Append admin details and icon to list item
          listItem.appendChild(adminDetails);
          listItem.appendChild(icon);

          // Append list item to todo list
          todoList.appendChild(listItem);
        }

        // Function to save admin details to localStorage
        function saveAdmins(name, email) {
          // Get existing admins from localStorage or initialize empty array
          const admins = JSON.parse(localStorage.getItem("admins")) || [];

          // Add new admin to the array
          admins.push({ name: name, email: email });

          // Save updated admins array back to localStorage
          localStorage.setItem("admins", JSON.stringify(admins));
        }

        // Function to load admin details from localStorage
        function loadAdmins() {
          // Get admins array from localStorage
          const admins = JSON.parse(localStorage.getItem("admins"));

          // If admins array exists, add each admin to the todo list
          if (admins) {
            admins.forEach(function (admin) {
              addAdminToList(admin.name, admin.email);
            });
          }
        }

        // Function to remove admin from localStorage
        function removeAdminFromStorage(name, email) {
          // Get existing admins from localStorage
          const admins = JSON.parse(localStorage.getItem("admins")) || [];

          // Find the index of the admin to remove
          const index = admins.findIndex(function (admin) {
            return admin.name === name && admin.email === email;
          });

          // If admin found, remove it from the array
          if (index !== -1) {
            admins.splice(index, 1);
            // Save updated admins array back to localStorage
            localStorage.setItem("admins", JSON.stringify(admins));
          }
        }
      });

      document.addEventListener("DOMContentLoaded", function () {
        const dropbtn = document.querySelector(".makeAdmin");
        const dropdownContent = document.querySelector(".makeAdmin-content");
        const adminForm = document.getElementById("makeAdminForm");
        const todoList = document.querySelector(".todo-list");

        // Load admin details from localStorage on page load
        loadAdmins();

        dropbtn.addEventListener("click", function (event) {
          event.stopPropagation(); // Prevents the document click event from immediately closing the dropdown
          dropdownContent.style.display = "block";
          dropdownContent.classList.toggle("show");
          document.querySelector(".dropdown-content").style.display = "none";
        });

        // Close the dropdown when clicking outside of it
        document.addEventListener("click", function (event) {
          if (
            !event.target.matches(".makeAdmin") &&
            !dropdownContent.contains(event.target)
          ) {
            dropdownContent.style.display = "none";
            dropdownContent.classList.remove("show");
          }
        });

        // Prevent the modal from closing when clicking inside the modal content
        dropdownContent.addEventListener("click", function (event) {
          event.stopPropagation();
        });

        // Prevent the modal from closing when clicking inside the input fields
        dropdownContent.querySelectorAll("input").forEach(function (input) {
          input.addEventListener("click", function (event) {
            event.stopPropagation();
          });
        });

        // Handle form submission
        adminForm.addEventListener("submit", async function (event) {
          event.preventDefault(); // Prevent the default form submission behavior

          // Get input values

          const adminEmail = document.getElementById("makeAdminEmail").value;
          // console.log(adminEmail)

          try {
            // Send request to create an admin
            const response = await fetch(API_LOCAL + "/changeToAdmin", {
              mode: "cors",
              method: "POST",
              headers: {
		'Authorization': `Bearer ${token}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ email: adminEmail }),
              credentials: "include",
            });

            if (response.status == 401) {
              location.href = "/login/";
              return;
            }

            if (response.status === 400) {
              alert("Admin already exists, kindly use another Email!");
            } else if (response.status === 200) {
              // Add admin to the todo list
              addAdminToList("-", adminEmail);
              // Save admin details to localStorage
              saveAdmins("-", adminEmail);
              // Clear input fields
              adminForm.reset();
              // Close dropdown
              dropdownContent.classList.remove("show");
            }
          } catch (error) {
            console.error("Error while adding an admin:", error);
          }
        });

        // Function to add admin to the todo list
        function addAdminToList(name, email) {
          // Create list item
          const listItem = document.createElement("li");
          listItem.classList.add("completed"); // Assuming newly added admins are marked as completed by default

          // Create paragraph element for admin details
          const adminDetails = document.createElement("p");
          adminDetails.textContent = `${name} (${email})`;

          // Create icon element
          const icon = document.createElement("i");
          icon.classList.add("bx", "bxs-trash-alt");
          icon.style.color = "#FF3800";
          icon.addEventListener("click", async function () {
            // Remove the list item when the icon is clicked
            // console.log(listItem)
            todoList.removeChild(listItem);
            // Remove the admin from localStorage
            removeAdminFromStorage("-", email);

            try {
              const response = await fetch(API_LOCAL + "/removeAdmin", {
                mode: "cors",
                method: "POST",
                headers: {
		  'Authorization': `Bearer ${token}`,
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ email }),
                credentials: "include",
              });
              if (response.status == 401) {
                location.href = "/login/";
                return;
              }
              if (response.status !== 200) {
                console.error("Failed to remove admin from the backend");
              }
            } catch (error) {
              console.error("Error removing admin:", error);
            }
          });

          // Append admin details and icon to list item
          listItem.appendChild(adminDetails);
          listItem.appendChild(icon);

          // Append list item to todo list
          todoList.appendChild(listItem);
        }

        // Function to save admin details to localStorage
        function saveAdmins(name, email) {
          // Get existing admins from localStorage or initialize empty array
          const admins = JSON.parse(localStorage.getItem("admins")) || [];

          // Add new admin to the array
          admins.push({ name: name, email: email });

          // Save updated admins array back to localStorage
          localStorage.setItem("admins", JSON.stringify(admins));
        }

        // Function to load admin details from localStorage
        function loadAdmins() {
          // Get admins array from localStorage
          const admins = JSON.parse(localStorage.getItem("admins"));

          // If admins array exists, add each admin to the todo list
          if (admins && todoList.children.length === 0) {
            admins.forEach(function (admin) {
              addAdminToList(admin.name, admin.email);
            });
          }
        }

        // Function to remove admin from localStorage
        function removeAdminFromStorage(name, email) {
          // Get existing admins from localStorage
          const admins = JSON.parse(localStorage.getItem("admins")) || [];

          // Find the index of the admin to remove
          const index = admins.findIndex(function (admin) {
            return admin.name === name && admin.email === email;
          });

          // If admin found, remove it from the array
          if (index !== -1) {
            admins.splice(index, 1);
            // Save updated admins array back to localStorage
            localStorage.setItem("admins", JSON.stringify(admins));
          }
        }
      });

      document.addEventListener("DOMContentLoaded", async function () {
        const downloadLogsButton = document.getElementById("download-logs");

        downloadLogsButton.addEventListener("click", async function (event) {
          event.preventDefault();

          try {
            // Fetch log data from the server
            const response = await fetch(API_LOCAL + "/logs", {
              credentials: "include",
		    headers: {
            'Authorization': `Bearer ${token}`,
            "Content-Type": "application/json",
          }
            });

            if (!response.ok) {
              throw new Error("Failed to fetch logs");
            }

            const data = await response.json();
            console.log(data); // Verify that you receive the correct data in the console

            // Format log data into CSV format
            const csvData = formatLogsToCSV(data);

            // Generate Excel file using SheetJS
            const worksheet = XLSX.utils.json_to_sheet(csvData, {
              header: csvData.shift(),
            });
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Logs");
            const excelData = XLSX.write(workbook, {
              bookType: "xlsx",
              type: "array",
            });

            // Trigger download of the Excel file
            downloadExcelFile(excelData);
          } catch (error) {
            console.error("Error fetching or processing logs:", error);
          }
        });
      });

      function formatLogsToCSV(logs) {
        if (typeof logs !== "object" || logs === null) {
          console.error("Invalid log data received: Expected an object");
          return [];
        }

        // Extract log entries from the object properties
        const logEntries = Object.values(logs);

        // Check if log entries array is empty
        if (logEntries.length === 0) {
          console.warn("No logs found");
          return [];
        }

        const csvData = [];

        // Extract headers from the first log entry
        const headers = Object.keys(logEntries[0]);
        csvData.push(headers);

        // Add data rows
        logEntries.forEach((log) => {
          const values = headers.map((header) => log[header]);
          csvData.push(values);
        });

        return csvData;
      }

      function downloadExcelFile(excelData) {
        // Convert array buffer to Blob
        const blob = new Blob([excelData], {
          type: "application/octet-stream",
        });

        // Create download link
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "logs.xlsx";

        // Trigger download
        document.body.appendChild(a);
        a.click();

        // Cleanup
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
      }
    </script>

    <script src="/management.js" type="module"></script>
  </body>
</html>
