<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/images/icon2.png" />
    <title>User Dashbord</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />

    <!-- For Excel downloading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- jQuery UI -->
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css"
    />
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />

    <link
      href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
    />
    <!-- Link to Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <!-- Your additional stylesheets -->
    <style>
      /* Your custom styles here */
      body {
        font-family: "Poppins", sans-serif;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"
    />
    <link rel="stylesheet" href="/profile.css" />
  </head>

  <body>
    <!-- nav bar -->
    <nav class="navbar navbar-expand-lg bg-light navbar-dark fixed-top p-2">
      <div class="container-fluid text-white">
        <!-- sidenavbar trigger -->

        <i
          class="bx bx-menu"
          style="color: rgb(0, 0, 0); font-size: 35px"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasExample"
          aria-controls="offcanvasExample"
          aria-label="Toggle navigation"
        ></i>

        <!-- //sidenavbar trigger -->
        <!-- <img class="d-flex ms-auto" src="public/images/logo.png" alt="" style="width: 100px;"> -->
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <!-- <img
            class="d-flex ms-auto"
            src="/images/logo.png"
            alt=""
            style="width: 190px; margin-right: -290px"
            id="logo"
          /> -->
          <img
            src="/images/bookiva4.png"
            alt=""
            style="width: 130px; margin-left: 800px"
            class="logo-img"
            id=""
          />
          <!-- <img
            src="/images/bookiva2.png"
            alt=""
            style="width: 130px; margin-top: 10px; margin-left: 5px"
            class="logo-img"
          /> -->

          <form class="d-flex ms-auto" role="download">
            <div class="input-group my-3 my-lg-0">
              <div class="form-control">Download</div>

              <button
                class="btn btn-primary"
                type="button"
                id="button-addon2"
                style="background-color: black"
              >
                <!-- <i class="bi bi-download"></i> -->
                <i
                  class="bi bi-download"
                  id="downloadIcon"
                  onclick="downloadBasedOnState()"
                ></i>
              </button>
            </div>
          </form>
          <ul class="navbar-nav mb-lg-0">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="bi bi-person-fill"></i>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li>
                  <hr class="dropdown-divider" />
                </li>

                <li>
                  <a class="dropdown-item" href="#">Something else here</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- //nav bar -->

    <!-- offcanvas -->
    <div
      class="offcanvas offcanvas-start bg-dark sidebar-nav text-white"
      tabindex="-1"
      id="offcanvasExample"
      aria-labelledby="offcanvasExampleLabel"
    >
      <div class="offcanvas-body p-0 mt-3" style="background-color: black">
        <nav class="navbar-dark">
          <ul class="navbar-nav text-white" id="navbar">
            <div class="collapse" id="collapseExample">
              <div>
                <a href="#" class="nav-link mx-3 active">
                  <span class="me-2 ps-3">
                    <i class="bi bi-speedometer2"></i>
                  </span>
                  <span> DASHBORD </span>
                </a>
              </div>
            </div>
            <br /><br />
            <li id="tableLink">
              <span class="text-uppercase text-muted fw-bold mx-3"> Core </span>
            </li>

            <li id="reservationsList" class="nav-item active">
              <a href="#" class="nav-link mx-3" data-target="reservations">
                <span class="me-2">
                  <i class="bi bi-clock"></i>
                </span>
                <span> RESERVATIONS </span>
              </a>
            </li>
            <!-- Accepted -->
            <li id="completedList" class="nav-item">
              <a href="#" class="nav-link mx-3" data-target="completed">
                <span class="me-2">
                  <i class="bi bi-check-circle"></i>
                </span>
                <span> COMPLETED </span>
              </a>
            </li>
            <!-- Denied -->
            <li id="profile" class="nav-item">
              <a href="#" class="nav-link mx-3" data-target="profile">
                <span class="me-2">
                  <i class="bi bi-person-circle"></i>
                </span>
                <span> PROFILE </span>
              </a>
            </li>
            <li id="halls" class="nav-item">
              <a
                href="/venues/index.html"
                class="nav-link mx-3"
                data-target="halls"
              >
                <span class="me-2">
                  <i
                    class="bx bx-home"
                    style="font-size: 19px; margin-left: -2px"
                  ></i>
                </span>
                <span>HALLS</span>
              </a>
            </li>

            <li id="dashboardLink">
              <hr class="my-4" />
            </li>

            <li id="logout" class="nav-item">
              <a href="#" class="nav-link mx-3" data-target="logout">
                <span class="me-2">
                  <i class="bx bx-log-out-circle"></i>
                </span>
                <span>LOG OUT</span>
              </a>
            </li>

            <!-- For Users -->
          </ul>
        </nav>
      </div>
    </div>
    <!--// offcanvas -->

    <!-- main -->
    <main class="mt-5 pt-3">
      <div class="container-fluid">
        <div class="row">
          <div id="recordsTitle" class="col-md-12 fw-bold fs-4">
            My Reservations
          </div>
        </div>
        <!-- card section -->

        <!-- Delete Confirmation Modal -->
        <div
          class="modal fade"
          id="deleteConfirmationModal"
          tabindex="-1"
          role="dialog"
          aria-labelledby="deleteConfirmationModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmationModalLabel">
                  Confirm Delete
                </h5>
                <button
                  type="button"
                  class="btn secondary-btn"
                  data-dismiss="modal"
                  aria-label="Close"
                  id="crossBtn"
                >
                  <span aria-hidden="true" style="font-size: 25px"
                    >&times;</span
                  >
                </button>
              </div>
              <div class="modal-body">
                Are you sure you want to delete this event?
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  id="cancelDeleteBtn"
                  data-dismiss="modal"
                >
                  Cancel
                </button>
                <button
                  type="button"
                  class="btn"
                  id="confirmDeleteBtn"
                  style="background-color: red; color: white"
                >
                  Delete
                </button>
              </div>
            </div>
          </div>
        </div>
        <!-- Modal Popup -->
        <div
          class="modal fade"
          id="myModal"
          tabindex="-1"
          role="dialog"
          aria-labelledby="myModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="myModalLabel">
                  Reason for Cancellation
                </h5>
                <button
                  type="button"
                  class="btn secondary-btn"
                  data-dismiss="modal"
                  aria-label="Close"
                  id="crossBtnaccepted"
                >
                  <span aria-hidden="true" style="font-size: 25px"
                    >&times;</span
                  >
                </button>
              </div>
              <div class="modal-body">
                <textarea
                  id="cancellationReason"
                  class="form-control"
                  rows="3"
                  style="max-height: 200px; resize: vertical"
                  placeholder="Enter reason for cancellation..."
                ></textarea>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn"
                  id="closeModalBtn"
                  data-dismiss="modal"
                  style="background-color: red; color: white"
                >
                  Cancel
                </button>
                <button
                  type="button"
                  class="btn btn-primary"
                  id="submitCancellationBtn"
                >
                  Submit
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <!-- <div class="col-md-3 mb-2">
            <div class="card text-bg-danger mb-3 h-100">
              <div class="card-header">Header</div>
              <div class="card-body">
                <h5 class="card-title">Primary card title</h5>
                <p class="card-text">
                  Some quick example text to build on the card title and make up
                  the bulk of the card's content.
                </p>
              </div>
            </div>
          </div> -->
          <!-- <div class="col-md-3 mb-2">
            <div class="card text-bg-success mb-3 h-100">
              <div class="card-header">Header</div>
              <div class="card-body">
                <h5 class="card-title">warning card title</h5>
                <p class="card-text">
                  Some quick example text to build on the card title and make up
                  the bulk of the card's content.
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-2">
            <div class="card text-bg-Primary mb-3 h-100">
              <div class="card-header">Header</div>
              <div class="card-body">
                <h5 class="card-title">Primary card title</h5>
                <p class="card-text">
                  Some quick example text to build on the card title and make up
                  the bulk of the card's content.
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-2">
            <div class="card text-bg-info mb-3 h-100">
              <div class="card-header">Header</div>
              <div class="card-body">
                <h5 class="card-title">Primary card title</h5>
                <p class="card-text">
                  Some quick example text to build on the card title and make up
                  the bulk of the card's content
                </p>
              </div>
            </div>
          </div>
        </div> -->
          <!-- //card section -->
          <!-- charts section -->
          <div class="row">
            <div class="col-md-6">
              <!-- <div class="card"> -->
              <!-- <div class="card-header">Charts</div> -->
              <div class="card-body">
                <!-- <canvas class="chart" id="chart" width="400" height="200">
                </canvas> -->
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <!-- <div class="card"> -->
            <div class="card-header"></div>
            <div class="card-body">
              <canvas
                class="chart"
                id="mychart"
                width="400"
                height="200"
                style="display: none"
              >
              </canvas>
            </div>
          </div>
        </div>
      </div>
      <!-- charts section -->
      <!-- table section -->

      <div class="row mt-3">
        <div class="col-md-15">
          <div class="filter-options" style="display: none">
            <label
              for="filter"
              style="font-weight: bold; font-size: 15px; margin-left: 8px"
              >Filter By:</label
            >

            <select id="hall-name-filter" class="table-filter">
              <option value="all" disabled selected>Hall Name</option>
              <option value="all" style="font-weight: bold">None</option>
              <option value="Alpha Hall" id="alpha">Alpha Hall</option>
              <option value="Beta Hall">Beta Hall</option>
              <option value="Gamma Hall">Gamma Hall</option>
              <option value="Sigma Hall">Sigma Hall</option>
              <option value="Leo Muthu Stadium">Leo Muthu Stadium</option>
              <option value="VRR Hall">VRR Hall</option>
              <option value="SSR Hall">SSR Hall</option>
              <option value="SIT AV Hall">SIT AV Hall</option>
              <option value="SIT Smart Classroom">SIT Smart Classroom</option>
              <option value="SEC AV Hall">SEC AV Hall</option>
              <!-- Add options for Hall Name filtering -->
            </select>

            <div class="table-filter" id="food-filter">
              <!-- <label for="food-filter">Food Type:</label> -->
              <div class="dropdown">
                <button class="dropbtn">Food Type</button>
                <div class="dropdown-content" id="food-dropdown">
                  <label
                    ><input type="checkbox" value="Breakfast" />
                    Breakfast</label
                  >
                  <label><input type="checkbox" value="Lunch" /> Lunch</label>
                  <label><input type="checkbox" value="Dinner" /> Dinner</label>
                  <!-- Add more food options here -->
                </div>
              </div>
            </div>

            <input
              type="text"
              id="start-date"
              class="table-filter"
              placeholder="Start Date"
            />
            <input
              type="text"
              id="end-date"
              class="table-filter"
              placeholder="End Date"
            />
          </div>
          <h6 style="font-weight: 600; padding-left: 7px" id="note">
            NOTE: If the Event is Successfully finished , then click the Upload
            button and upload the event pic to get Completed!
          </h6>
          <br />

          <div class="card">
            <div
              id="logoutModal"
              class="modal"
              data-easein="bounceIn"
              tabindex="-1"
              role="dialog"
              aria-labelledby="logoutModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h4 class="modal-title">LOG OUT?</h4>
                    <button
                      type="button"
                      class="btn secondary-btn"
                      data-dismiss="modal"
                      aria-label="Close"
                      id="crosslogout"
                    >
                      <span aria-hidden="true" style="font-size: 25px"
                        >&times;</span
                      >
                    </button>
                  </div>
                  <div class="modal-body">
                    <p>Are you sure to log out?</p>
                  </div>
                  <div class="modal-footer">
                    <button
                      class="btn btn-default"
                      data-dismiss="modal"
                      id="closelogout"
                      aria-hidden="true"
                    >
                      Close
                    </button>
                    <button class="btn btn-primary" id="confirmLogout">
                      Ok
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- <div class="card-header">Data tables</div> -->
            <div class="card-body">
              <table id="animation-table">
                <tbody>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                  <tr>
                    <td class="td-1"><span></span></td>
                    <td class="td-2"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-3"><span></span></td>
                    <td class="td-4"></td>
                    <td class="td-5"><span></span></td>
                    <td class="td-5"><span></span></td>
                  </tr>
                </tbody>
              </table>
              <div class="table-responsive">
                <!-- <table
                    id="example"
                    class="display data-table"
                    style="width: 100%"
                  >
                    <thead>
                      <tr>
                        <th>No</th>
                        <th>Hall name</th>
                        <th>Name</th>
                        <th>Dept</th>
                        <th>Date</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Seats</th>
                        <th>Event Name</th>
                        <th>Purpose</th>
                        <th>Refresh For</th>
                        <th>Refresh Type</th>
                        <th>Food</th>
                        <th>Accept</th>
                        <th >Reject</th>
                        
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Tiger Nixon</td>
                        <td>System Architect</td>
                        <td>Edinburgh</td>
                        <td>61</td>
                        <td>2011-04-25</td>
                        <td>$320,800</td>
                        <td>Tiger Nixon</td>
                        <td>System Architect</td>
                        <td>Edinburgh</td>
                        <td>Edinburgh</td>
                        <td>61</td>
                        <td>2011-04-25</td>
                        <td>$320,800</td>

                  
                        <td>2011-04-25</td>
                        <td>$320,800</td>
                      </tr>
                   
                      
                    </tbody>
                    <tfoot>
                      <tr>
                        <th>Name</th>
                        <th>Position</th>
                        <th>Office</th>
                        <th>Age</th>
                        <th>Start date</th>
                        <th>Salary</th>
                      </tr>
                    </tfoot>
                  </table> -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--//table section -->
    </main>
    <!-- //main -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js
  "></script>
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <!-- <script src="/profile.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <!-- Include jQuery UI CSS -->
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css"
    />

    <!-- Include jQuery UI JavaScript -->
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>

    <!-- Include Boxicons CSS -->
    <link
      href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css"
      rel="stylesheet"
    />

    <script type="module">
      let currentState = "reservations";

      const downloadExcel = (tableid) => {
        // console.log(tableid);
        const originalTable = $(`#${tableid}`).DataTable();

        if (originalTable.rows().count() === 0) {
          console.log("Table is empty. Cannot download Excel.");
          alert("Table is empty. Cannot download Excel.");
          return;
        }
        // Disable pagination
        originalTable.page.len(-1).draw();

        // Convert the table to Excel
        const workbook = XLSX.utils.table_to_book(
          originalTable.table().node(),
          { sheet: "Sheet 1" }
        );
        const excelBuffer = XLSX.write(workbook, {
          bookType: "xlsx",
          type: "array",
        });
        const blob = new Blob([excelBuffer], {
          type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
        });
        saveAs(blob, `${tableid}.xlsx`);

        // Re-enable pagination
        originalTable.page.len(10).draw();
      };

      const setCurrentState = (state) => {
        currentState = state;
        // console.log(currentState)
      };

      const downloadBasedOnState = () => {
        if (currentState === "reservations") {
          downloadExcel("user-reservations-records");
        } else if (currentState === "completed") {
          downloadExcel("user-completed-records");
        }
      };

      $(document).ready(function () {
        // Initialize datepicker for Start Date input
        $("#start-date").datepicker({
          dateFormat: "yy/mm/dd", // Day, Month, Year format
          onSelect: function () {
            // Trigger filtering function when a date is selected
            filterTableData();
          },
        });

        // Initialize datepicker for End Date input
        $("#end-date").datepicker({
          dateFormat: "yy/mm/dd", // Day, Month, Year format
          onSelect: function () {
            // Trigger filtering function when a date is selected
            filterTableData();
          },
        });
      });
    </script>

    <style>
      .filter-options {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
      }

      .filter-options > * {
        margin-bottom: 1rem; /* Add some spacing between each filter option */
      }

      .filter-options input[type="text"] {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        outline: none;
        width: 200px;
      }

      .filter-options input[type="text"]:focus,
      .filter-options select:focus {
        border-color: #007bff; /* Change border color on focus */
      }

      .filter-options select {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        outline: none;
        /* width: 150px;  */
      }

      /* Dropdown Button */
      .dropbtn {
        background-color: rgb(255, 255, 255);
        border: 1px solid #ddd;
        color: black;
        padding: 10px;
        font-size: 14px;
        border-radius: 4px;
        cursor: pointer;
      }

      /* Dropdown Content (Hidden by Default) */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
        z-index: 1;
        padding: 10px;
        border-radius: 4px;
        border: 1px solid #c5c5c5;
        overflow-y: auto;
      }

      /* Show the dropdown content on hover */
      .dropdown:hover .dropdown-content {
        display: block;
      }
      @media screen and (max-width: 400px) {
        #note {
          font-size: small;
        }
        .dataTables_filter input[type="search"] {
          border: 1px solid #ccc;
          width: 60%;
          padding: 7px;
          border-radius: 20px;
          margin-right: 5px;
        }
        .dataTables_wrapper select {
          margin-top: 20px;
          text-align: left;
        }
      }
    </style>
    <style>
      .dataTables_filter input[type="search"] {
        border: 1px solid #ccc;
        padding: 7px;
        border-radius: 20px;
        margin-right: 10px;
      }
    </style>

    <script type="module">
      import Cookies from "js-cookie";
      const token =  Cookies.get("jwt");
      const API_LOCAL = "https://bookiva-backend-incubation.vercel.app";
      let NAME, Name, EMAIL;
      menu();
      async function menu() {
        const response = await fetch(API_LOCAL + "/profile", {
          credentials: "include", // Include cookies with the request
          headers: {
            'Authorization': `Bearer ${token}`,
            "Content-Type": "application/json",
          },
        });
        if (response.status == 401) {
          location.href = "/login/";
        }
      }

      $(document).ready(function () {
        $(".data-table").each(function (_, table) {
          $(table).DataTable();
        });
      });

      var reservationsdata;
      var completeddata;
      var profiledata;

      var pendingButtonStyle =
        "background-color: #b8d4ff; color: #3a81eb; padding: 0.1px 10px; border: none; border-radius: 5px;cursor: default;";
      var acceptButtonStyle =
        "background-color: #ffe4a1; color: #C29C00; padding: 0.1px 10px; border: none; border-radius: 5px; cursor: default;";
      var rejectButtonStyle =
        "background-color: #ffaaaa; color: #58111A; padding: 0.1px 10px; border: none; border-radius: 5px; cursor: default;";
      var completedButtonStyle =
        "background-color: #c3faca; color: #3CB371; padding: 0.1px 10px; border: none; border-radius: 5px;cursor: default;";
      var uploadedButtonStyle =
        "background-color: #1CAC78; color: white; padding: 5px 10px; border: none; border-radius: 5px;cursor: default;";
      // // Function to create a new table element with the provided bookings data and type
      const createTable = (bookings, type) => {
        // console.log(bookings);
        // $(".table-responsive").empty();

        const tableId = `user-${type}-records`;
        $("#animation-table").remove();

        // console.log(tableId);
        if (!bookings || bookings.length === 0) {
          const hideFilterOptions = $(`.filter-options`).css({
            display: "none",
          });
          const message = `There is no ${type} data.`;
          const messageDiv = $(`<div>${message}</div>`).css({
            "text-align": "center",
          });
          return messageDiv;
        }
        $(`.filter-options`).css({ display: "flex" });
        $(`.input-group`).css({ display: "flex" });

        // Create a new table element
        const table = $("<table>")
          .attr("id", `user-${type}-records`)
          .addClass("display data-table")
          .css("width", "100%", "overflowX", "auto");

        let thead = $("<thead>").appendTo(table);

        if (type === "reservations") {
          $(".dropbtn").css({ display: "flex" });
          $("#note").css({ display: "flex" });
          $("<tr>")
            .appendTo(thead)
            .append("<th>No</th>")
            .append("<th>Hall name</th>")
            .append("<th>Date</th>")
            .append("<th>Start Time</th>")
            .append("<th>End Time</th>")
            .append("<th>Seats</th>")
            .append("<th>Event Name</th>")
            .append("<th>Purpose</th>")
            .append("<th>Refresh For</th>")
            .append("<th>Refresh Type</th>")
            .append("<th>Food</th>")
            .append("<th>Status</th>")
            .append("<th>Upload</th>")
            .append(`<th>Delete</th>`);

          // Create the table body
          const tbody = $("<tbody>").appendTo(table);

          // Populate table with fetched data
          bookings.forEach((booking, index) => {
            const newRow = $("<tr>");

            newRow.append(`<td>${index + 1}</td>`); // Index starts from 0
            newRow.append(`<td>${booking.hallname}</td>`);
            newRow.append(
              `<td>${new Date(booking.date).toLocaleDateString("en-GB")}</td>`
            );
            newRow.append(
              `<td>${new Date(booking.starttime).getUTCHours() % 12 || 12}:${
                (new Date(booking.starttime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.starttime).getUTCMinutes()
              } ${
                new Date(booking.starttime).getUTCHours() < 12 ? "AM" : "PM"
              }</td>`
            );
            newRow.append(
              `<td>${new Date(booking.endtime).getUTCHours() % 12 || 12}:${
                (new Date(booking.endtime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.endtime).getUTCMinutes()
              } ${
                new Date(booking.endtime).getUTCHours() < 12 ? "AM" : "PM"
              }</td>`
            );
            newRow.append(`<td>${booking.seating}</td>`);
            newRow.append(`<td>${booking.eventname}</td>`);
            newRow.append(`<td>${booking.purpose.toLowerCase()}</td>`);
            newRow.append(`<td>${booking.refreshmentfor.toLowerCase()}</td>`);
            newRow.append(`<td>${booking.refreshmenttype.toLowerCase()}</td>`);
            newRow.append(`<td>${booking.food.join(" ")}</td>`);

            if (booking.status === "pending") {
              newRow.append(
                `<td><button style="${pendingButtonStyle}"  >Pending</button></td>`
              );
              newRow.append(`<td>-</td>`);
            } else if (
              booking.status === "denied" ||
              booking.status === "denied_temp"
            ) {
              newRow.append(`<td><button class="original-button" 
            booking-email="${booking.email}"
            booking-hallname="${booking.hallname}"
            booking-date="${new Date(booking.date).toLocaleDateString("en-GB")}"
            booking-startTime="${
              new Date(booking.starttime).getUTCHours() % 12 || 12
            }:${
                (new Date(booking.starttime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.starttime).getUTCMinutes()
              } ${new Date(booking.starttime).getUTCHours() < 12 ? "AM" : "PM"}"
            booking-endTime="$${
              new Date(booking.endtime).getUTCHours() % 12 || 12
            }:${
                (new Date(booking.endtime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.endtime).getUTCMinutes()
              } ${new Date(booking.endtime).getUTCHours() < 12 ? "AM" : "PM"}"
            booking-chiefguest="${booking.chiefguest}"
            booking-eventname="${booking.eventname}"
            style="${rejectButtonStyle}" >Denied</button></td>`);
              newRow.append(`<td>-</td>`);
            } else if (booking.status === "accepted") {
              newRow.append(
                `<td ><button style="${acceptButtonStyle}" >Accepted</button></td>`
              );
              const currentDate = new Date();
              const bookingDate = new Date(booking.date);

              // Check if booking date is today or in the past
              if (bookingDate <= currentDate) {
                // If booking date is today or in the past, change cursor style to 'pointer'

                newRow.append(
                  `<td data-item-_id="${
                    booking._id
                  }"><button style="${uploadedButtonStyle.replace(
                    "cursor: default;",
                    "cursor: pointer;"
                  )}" class="upload-button">Upload</button></td>`
                );
              } else {
                // If booking date is in the future, keep the cursor style as 'default'

                newRow.append(
                  `<td data-item-_id="${booking._id}"><button style="${uploadedButtonStyle}; opacity: 0.5; cursor:not-allowed"  >Upload</button></td>`
                );
              }
            }
            newRow
              .append(
                `<td data-status="${booking.status}" data-item-_id=${booking._id}><span>   <i class="bi bi-trash-fill" style="color: red;cursor:pointer"></i><span></td>`
              )
              .css("text-align", "center");
            tbody.append(newRow);
          });
        } else if (type === "completed") {
          $("#note").css({ display: "none" });
          $(".dropbtn").css({ display: "none" });
          $("<tr>")
            .appendTo(thead)
            .append("<th>No</th>")
            .append("<th>Hall name</th>")
            .append("<th>Date</th>")
            .append("<th>Start Time</th>")
            .append("<th>End Time</th>")
            .append("<th>Event Name</th>")
            .append("<th>Purpose</th>")
            .append("<th>File</th>")
            .append("<th>Feedback Link</th>")
            .append("<th>Status</th>");

          // Create the table body
          const tbody = $("<tbody>").appendTo(table);

          // Populate table with fetched data
          bookings.forEach((booking, index) => {
            const newRow = $("<tr>");

            newRow.append(`<td>${index + 1}</td>`); // Index starts from 0
            newRow.append(`<td>${booking.hallname}</td>`);
            newRow.append(
              `<td>${new Date(booking.date).toLocaleDateString("en-GB")}</td>`
            );
            newRow.append(
              `<td>${new Date(booking.starttime).getUTCHours() % 12 || 12}:${
                (new Date(booking.starttime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.starttime).getUTCMinutes()
              } ${
                new Date(booking.starttime).getUTCHours() < 12 ? "AM" : "PM"
              }</td>`
            );
            newRow.append(
              `<td>${new Date(booking.endtime).getUTCHours() % 12 || 12}:${
                (new Date(booking.endtime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.endtime).getUTCMinutes()
              } ${
                new Date(booking.endtime).getUTCHours() < 12 ? "AM" : "PM"
              }</td>`
            );

            newRow.append(`<td>${booking.eventname}</td>`);
            newRow.append(`<td>${booking.purpose.toLowerCase()}</td>`);
            newRow.append(
              `<td><a href="${API_LOCAL}/download/${booking.file.fileId}" target="_blank">Uploaded File</a></td>`
            );
            newRow.append(
              `<td><a href="${booking.feedback}" class="copy-link" target="_blank">Share Feedback</a></td>`
            );
            newRow.append(
              `<td><button style="${completedButtonStyle}" >Completed</button></td>`
            );

            tbody.append(newRow);
          });
        }

        return table;
      };

      $(document).on("click", ".copy-link", function (event) {
        event.preventDefault();
        const link = $(this).attr("href");
        navigator.clipboard
          .writeText(link)
          .then(() => {
            alert("Link copied to clipboard");
          })
          .catch((err) => {
            console.error("Failed to copy link: ", err);
          });
      });

      const createProfile = () => {
        // Check if the profile section already exists, if yes, then return
        $(`.filter-options`).css({ display: "none" });
        $("#note").css({ display: "none" });
        $(`.input-group`).css({ display: "none" });
        $(`#logo`).css({ "margin-right": "-180px" });
        if ($("#profileSection").length > 0) return $("#profileSection");

        // Create the profile section
        const profileSection = $(`
        <div id="profileSection" style="max-width: 600px; margin: 0 auto; background-color: #fff; padding: 20px; border: 1px solid #ccc; border-radius: 5px;">
    <h3 class="form-title" style="text-align:center;">Profile Details</h3>
    <form id="createProfileForm">
        <div class="user-input-box">
            <label for="fullName" style="font-weight:bold;">Name</label>
            <input type="text" id="name" name="name" placeholder="Your Name" value="${profiledata.name}" required style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;">
        </div>
        <div class="user-input-box">
            <label for="email" style="font-weight:bold;">Email ID</label>
            <input type="email" id="email" name="email" placeholder="Your Email ID" value="${profiledata.email}" readonly style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; background-color: #f4f4f4;">
        </div>
        <div class="user-input-box">
            <label for="college" style="font-weight:bold;">College Name</label>
            <input type="text" id="college" name="college" placeholder="College Name" value="${profiledata.college}" required style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;">
        </div>
        <div class="user-input-box">
            <label for="department" style="font-weight:bold;">Department Ex: (EEE , IT , CSE)</label>
            <input type="text" id="department" name="department" placeholder="Your Department" value="${profiledata.dept}" required style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;">
        </div>
        <div style="text-align: center;">
            <button type="button" id="updateButton" style="padding: 10px 20px; background-color: #009150; color: white; border: none; border-radius: 4px; cursor: pointer;">Update</button>
        </div>
    </form>   
</div>

        `);

        // Append the profile section to the body
        $("body").append(profileSection);

        $("#updateButton").on("click", function () {
          const updatedName = $("#name").val();
          const updatedCollege = $("#college").val();
          const updatedDept = $("#department").val();

          // Perform update request
          const button = $(this);

          button.prop("disabled", true); // Disable the button to prevent multiple clicks
          button.html("Updating..."); // Change button text to Loading...
          button.css({
            transition: "background-color 0.3s ease",
            backgroundColor: "rgba(0, 0, 0, 0.5)", // Fade the button to a semi-transparent black color
          });
          fetch(API_LOCAL + "/updateprofile", {
            method: "POST",
            credentials: "include",
            headers: {
              'Authorization': `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ updatedName, updatedCollege, updatedDept }),
          })
            .then((res) => {
              if (res.status === 200) {
                // Success message
                console.log("Profile updated successfully");
                alert("Profile updated successfully");
                // Redirect or show a message to the user
              } else {
                // Error message
                console.log("Error updating profile");
                alert("Error updating profile");
                // Redirect or show a message to the user
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              // Handle error
            })
            .finally(() => {
              // Revert button style to normal
              button.prop("disabled", false); // Re-enable the button
              button.html("Update"); // Change button text back to Update
              button.css({
                backgroundColor: "#009150", // Restore original background color
              });
            });
        });

        return profileSection; // Return the profile section
      };

      // Function to fetch and display data in the table
      const fetchAndDisplayData = async () => {
        try {
          // Fetch data from the API based on the selected type
          const response = await fetch(API_LOCAL + "/userdata", {
            method: "POST",
            credentials: "include", // Include cookies with the request
            headers: {
              'Authorization': `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });
          if (response.status == 401) {
            Cookies.remove('jwt', { path: '/' });
            location.href = "/login/";
            return;
          }
          const data = await response.json();
          $("#animation-table").remove();
          // Assuming data structure is consistent
          reservationsdata = data.reservationsdata;
          completeddata = data.completeddata;
          profiledata = data.user;

          // console.log(data,currentState);
          var newTable;
          // Create a new table with fetched data
          if (currentState == "reservations") {
            newTable = createTable(reservationsdata, currentState);
          } else if (currentState == "completed") {
            newTable = createTable(completeddata, currentState);
          } else if (currentState == "profile") {
            newTable = createProfile();
          }

          // Clear existing table data
          $(".table-responsive").empty();

          // Append the new table to the table-responsive div
          $(".table-responsive").append(newTable);

          // Initialize DataTable for the new table
          initializeDataTable(`user-${currentState}-records`);
        } catch (error) {
          console.log(error);
          // Handle errors
        }
      };

      $(document).on("click", ".bi-trash-fill", async function () {
        var bookingId = $(this).closest("td").data("item-_id");
        var bookingStatus = $(this).closest("td").data("status");
        // console.log(bookingId, bookingStatus);

        if (bookingStatus === "accepted") {
          $("#myModal").modal("show"); // Show the modal popup

          $("#myModal").on(
            "click",
            "#submitCancellationBtn",
            async function () {
              // const bookingId = $(this).closest('.modal-content').find('.bi-trash-fill').closest('td').data('item-_id');
              const cancellationReason = $("#cancellationReason").val(); // Get the reason for cancellation from the textarea
              // console.log(bookingId, cancellationReason);

              // Send the reason for cancellation to the server
              const response = await fetch(API_LOCAL + "/reason", {
                method: "POST",
                credentials: "include",
                headers: {
                  'Authorization': `Bearer ${token}`,
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ bookingId, cancellationReason }),
              });

              if (response.ok) {
                // Do something after successful submission, like closing the modal
                $("#myModal").modal("hide");
                setCurrentState("reservations");
                fetchAndDisplayData();
                createTable(reservationsdata, currentState);
              } else {
                alert(
                  "Some error occurred while submitting the reason, Please try again!"
                );
              }
            }
          );
        } else {
          $("#deleteConfirmationModal").modal("show"); // Show the delete confirmation modal
          $("#deleteConfirmationModal").on(
            "click",
            "#confirmDeleteBtn",
            async function () {
              $("#deleteConfirmationModal").modal("hide"); // Hide the delete confirmation modal
              const response = await fetch(API_LOCAL + "/deleteevent", {
                method: "POST",
                credentials: "include", // Include cookies with the request
                headers: {
                  'Authorization': `Bearer ${token}`,
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ bookingId, bookingStatus }), // Pass the bookingId to the server
              });
              // console.log(response.ok);
              if (response.status) {
                setCurrentState("reservations");
                fetchAndDisplayData();
                createTable(reservationsdata, currentState);
              } else {
                alert(
                  "Some error occurred while deleting the Event, Please try again!"
                );
              }
            }
          );
        }
      });

      // Close modal if "Close" button is clicked
      $("#closeModalBtn").click(function () {
        $("#myModal").modal("hide");
      });
      $("#crossBtnaccepted").click(function () {
        $("#myModal").modal("hide");
      });

      $("#cancelDeleteBtn").click(function () {
        $("#deleteConfirmationModal").modal("hide");
      });

      $("#crossBtn").click(function () {
        $("#deleteConfirmationModal").modal("hide");
      });

      $(document).on("click", ".upload-button", async function () {
        var bookingId = $(this).closest("td").data("item-_id");
        const encryptedFormData = encryptData(bookingId);
        // console.log("Accepted",bookingId,encryptedFormData);
        location.href = `/completedform/index.html?${encryptedFormData}`;
        function encryptData(data) {
          const mockKey = "tamper-shouldnot-allowed";
          const encryptedData = CryptoJS.AES.encrypt(data, mockKey).toString();
          return encryptedData;
        }
      });

      // Initial fetch and display of pending data
      $(document).ready(function () {
        fetchAndDisplayData(); // Fetch and display pending data initially
      });

      // Click event handlers for navigation links
      $(document).ready(function () {
        // Click event handler for pending link
        $("#navbar li:nth-child(5)").click(function () {
          $("#recordsTitle").text("My Reservations");

          if (currentState != "reservations") {
            // console.log(currentState)
            setCurrentState("reservations");
            fetchAndDisplayData();

            updateTable(reservationsdata, "reservations");
          }
        });

        // Click event handler for accepted link
        $("#navbar li:nth-child(6)").click(function () {
          $("#recordsTitle").text("Completed List");

          if (currentState != "completed") {
            setCurrentState("completed");
            fetchAndDisplayData();
            // console.log(currentState)
            updateTable(completeddata, "completed");
          }
        });

        // Click event handler for denied link
        $("#navbar li:nth-child(7)").click(function () {
          $("#recordsTitle").text("My Profile");

          if (currentState != "profile") {
            // console.log(currentState)

            setCurrentState("profile");
            fetchAndDisplayData();
            // updateTable(dataDenied, 'denied');
          }
        });
      });

      // Function to initialize DataTable for the table with given ID
      const initializeDataTable = (tableId) => {
        $(`#${tableId}`).DataTable({
          language: {
            paginate: {
              next: ">>",
              previous: "<<",
            },
          },
          dom: '<"top"pfl<"clear">>rt<"bottom"ip<"clear">>',
        });
      };

      // // // Function to update the table with given data and type
      const updateTable = (bookings, type) => {
        // Check if the table already exists
        $("#hall-name-filter").val("all");
        $("#dept-filter").val("all");
        $("#start-date").val("");
        $("#end-date").val("");
        $("#food-dropdown input:checked").prop("checked", false);
        const tableExists = $(`#admin-${type}-records`).length > 0;

        // If the table already exists, replace its contents
        if (tableExists) {
          // console.log("if")
          // Destroy the existing DataTable instance
          $(`#user-${type}-records`).DataTable().destroy();

          const newTable = createTable(bookings, type);
          $(`#user-${type}-records`).replaceWith(newTable);
          initializeDataTable(`user-${type}-records`);
        } else {
          // If the table doesn't exist, create and initialize it
          // console.log("else")
          const newTable = createTable(bookings, type);
          $(".table-responsive").empty().append(newTable);
          initializeDataTable(`user-${type}-records`);
        }
      };

      const filterTableData = () => {
        const hallName = $("#hall-name-filter").val();

        const startDate = $("#start-date").val();
        const endDate = $("#end-date").val();
        const selectedFood = [];

        // Get selected food options
        $("#food-dropdown input:checked").each(function () {
          selectedFood.push($(this).val());
        });

        const filteredData = [];

        let dataToFilter;
        switch (currentState) {
          case "reservations":
            dataToFilter = reservationsdata;
            break;
          case "completed":
            dataToFilter = completeddata;
            break;

          default:
            dataToFilter = [];
            break;
        }
        // console.log(dataToFilter)
        if (dataToFilter) {
          dataToFilter.forEach((booking) => {
            if (
              (hallName === "all" ||
                hallName === null ||
                booking.hallname === hallName) &&
              (startDate === "" ||
                startDate === null ||
                new Date(booking.date) >= new Date(startDate)) &&
              (endDate === "" ||
                endDate === null ||
                new Date(booking.date) <=
                  new Date(endDate).setHours(23, 59, 59)) &&
              (selectedFood.length === 0 ||
                selectedFood.some((food) => booking.food.includes(food)))
            ) {
              const originalIndex = dataToFilter.findIndex(
                (item) => item === booking
              );
              // console.log(originalIndex)
              filteredData.push({ booking, originalIndex });
            }
            // console.log(booking)
          });
        }

        // Clear existing table data
        $(`#user-${currentState}-records tbody`).empty();

        // Create the table
        const table = $("<table>")
          .attr("id", `user-${currentState}-records`)
          .addClass("display data-table")
          .css("width", "100%");

        // Create the table header
        let thead = $("<thead>").appendTo(table);

        if (currentState === "reservations") {
          $("<tr>")
            .appendTo(thead)
            .append("<th>No</th>")
            .append("<th>Hall name</th>")
            .append("<th>Date</th>")
            .append("<th>Start Time</th>")
            .append("<th>End Time</th>")
            .append("<th>Seats</th>")
            .append("<th>Event Name</th>")
            .append("<th>Purpose</th>")
            .append("<th>Refresh For</th>")
            .append("<th>Refresh Type</th>")
            .append("<th>Food</th>")
            .append("<th>Status</th>")
            .append(`<th>Delete</th>`);

          // Create the table body
          const tbody = $("<tbody>").appendTo(table);
          // console.log(filteredData)

          // Populate table with fetched data
          filteredData.forEach(({ booking, originalIndex }) => {
            // console.log(booking.hallname)
            const newRow = $("<tr>");

            newRow.append(`<td>${originalIndex + 1}</td>`); // Index starts from 0
            newRow.append(`<td>${booking.hallname}</td>`);
            newRow.append(
              `<td>${new Date(booking.date).toLocaleDateString("en-GB")}</td>`
            );
            newRow.append(
              `<td>${new Date(booking.starttime).getUTCHours() % 12 || 12}:${
                (new Date(booking.starttime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.starttime).getUTCMinutes()
              } ${
                new Date(booking.starttime).getUTCHours() < 12 ? "AM" : "PM"
              }</td>`
            );
            newRow.append(
              `<td>${new Date(booking.endtime).getUTCHours() % 12 || 12}:${
                (new Date(booking.endtime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.endtime).getUTCMinutes()
              } ${
                new Date(booking.endtime).getUTCHours() < 12 ? "AM" : "PM"
              }</td>`
            );
            newRow.append(`<td>${booking.seating}</td>`);
            newRow.append(`<td>${booking.eventname}</td>`);
            newRow.append(`<td>${booking.purpose.toLowerCase()}</td>`);
            newRow.append(`<td>${booking.refreshmentfor.toLowerCase()}</td>`);
            newRow.append(`<td>${booking.refreshmenttype.toLowerCase()}</td>`);
            newRow.append(`<td>${booking.food.join(" ")}</td>`);

            if (booking.status === "pending") {
              newRow.append(
                `<td><button style="${pendingButtonStyle}"  >Pending</button></td>`
              );
            } else if (
              booking.status === "denied" ||
              booking.status === "denied_temp"
            ) {
              newRow.append(
                `<td><button class="original-button" style="${rejectButtonStyle}" >Denied</button></td>`
              );
            } else if (booking.status === "accepted") {
              newRow.append(
                `<td data-item-_id="${booking._id}"><button style="${acceptButtonStyle}" class="upload-button">Accepted</button></td>`
              );
            }
            newRow
              .append(
                `<td data-status="${booking.status}" data-item-_id=${booking._id}><span>   <i class="bi bi-trash-fill" style="color: red;cursor:pointer"></i><span></td>`
              )
              .css("text-align", "center");
            tbody.append(newRow);
          });
        } else if (currentState === "completed") {
          $("<tr>")
            .appendTo(thead)
            .append("<th>No</th>")
            .append("<th>Hall name</th>")
            .append("<th>Date</th>")
            .append("<th>Start Time</th>")
            .append("<th>End Time</th>")
            .append("<th>Event Name</th>")
            .append("<th>Purpose</th>")
            .append("<th>File</th>")
            .append("<th>Feedback Link</th>")
            .append("<th>Status</th>");

          // Create the table body
          const tbody = $("<tbody>").appendTo(table);

          // Populate table with fetched data
          filteredData.forEach(({ booking, originalIndex }) => {
            const newRow = $("<tr>");

            newRow.append(`<td>${originalIndex + 1}</td>`); // Index starts from 0
            newRow.append(`<td>${booking.hallname}</td>`);
            newRow.append(
              `<td>${new Date(booking.date).toLocaleDateString("en-GB")}</td>`
            );
            newRow.append(
              `<td>${new Date(booking.starttime).getUTCHours() % 12 || 12}:${
                (new Date(booking.starttime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.starttime).getUTCMinutes()
              } ${
                new Date(booking.starttime).getUTCHours() < 12 ? "AM" : "PM"
              }</td>`
            );
            newRow.append(
              `<td>${new Date(booking.endtime).getUTCHours() % 12 || 12}:${
                (new Date(booking.endtime).getUTCMinutes() < 10 ? "0" : "") +
                new Date(booking.endtime).getUTCMinutes()
              } ${
                new Date(booking.endtime).getUTCHours() < 12 ? "AM" : "PM"
              }</td>`
            );

            newRow.append(`<td>${booking.eventname}</td>`);
            newRow.append(`<td>${booking.purpose.toLowerCase()}</td>`);
            newRow.append(
              `<td><a href="${API_LOCAL}/download/${booking.file.fileId}" target="_blank">Uploaded File</a></td>`
            );
            newRow.append(
              `<td><a href="${booking.feedback}" class="copy-link" target="_blank">Share Feedback</a></td>`
            );
            newRow.append(
              `<td><button style="${completedButtonStyle}" >Completed</button></td>`
            );

            tbody.append(newRow);
          });
        }

        // Append the new table to the table-responsive div
        $(".table-responsive").empty().append(table);

        // Initialize DataTable for the new table
        $(`#user-${currentState}-records`).DataTable();
      };

      // Event listener for filter options
      $(".table-filter").change(function () {
        filterTableData(); // Filter table data when filter options change
      });

      // // Initial filter of table data
      // $(document).ready(function () {
      //   filterTableData(); // Filter table data initially
      // });

      $(document).ready(function () {
        // Event listener for list items
        $("#navbar li:not(#dashboardLink)").click(function () {
          // Remove active class from all list items
          $("#navbar li").removeClass("active");

          // Add active class to the clicked list item

          $(this).addClass("active");

          // Apply animation
          $(this).css({ transform: "translateY(3px)" });
          setTimeout(() => {
            $(this).css({ transform: "translateY(0)" });
          }, 200);
        });
      });

      $(document).ready(function () {
        $("#logout").on("click", function () {
          var logoutModal = $("#logoutModal");
          logoutModal.modal("show");
        });

        $("#logoutModal").on("shown.bs.modal", function () {
          $(this)
            .find(".modal-dialog")
            .addClass("animate__animated animate__bounceIn");
        });

        // Handle confirm logout button click
        $("#closelogout").on("click", function () {
          $("#logoutModal").modal("hide"); // Close the modal
        });

        $("#crosslogout").on("click", function () {
          $("#logoutModal").modal("hide"); // Close the modal
        });

        $("#confirmLogout").on("click", async function () {
          $("#logoutModal").modal("hide"); // Close the modal
          const res = await fetch(API_LOCAL + "/logout", {
            credentials: "include", // Include cookies with the request
            headers: {
              'Authorization': `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });
          if (res.status == 200) {
            Cookies.remove('jwt', { path: '/' });
            location.href = "/login/";
          }
        });
      });
    </script>
  </body>
</html>
